angular.module("hawkular.charts",[]);var Charts;!function(t){"use strict";function e(t,e,n){var a=d3.svg.line().interpolate("monotone").x(function(e){return t(e.timestamp)}).y(function(t){return e(n)});return a}function n(t,n,a,r,i){var o=t.selectAll("path.alertLine").data([r]);o.attr("class","alertLine").attr("d",e(n,a,i)),o.enter().append("path").attr("class","alertLine").attr("d",e(n,a,i)),o.exit().remove()}function a(t,e){function n(t,e){var n,a=[];return t.forEach(function(r,i){0===i&&r.avg>e?a.push(i):(n=t[i-1],r.avg>e&&n&&(!n.avg||n.avg<=e)&&a.push(n.avg?i-1:i))}),a}function a(e,n){var a,r,o,s=[];return e.forEach(function(e){o=t[e];for(var c=e;c<t.length-1;c++)if(a=t[c],r=t[c+1],a.avg>n&&r.avg<=n||a.avg>n&&!r.avg){s.push(new i(o.timestamp,r.avg?r.timestamp:a.timestamp,n));break}}),s.length===e.length-1&&s.push(new i(t[e[e.length-1]].timestamp,t[t.length-1].timestamp,n)),s}var r,o;return o=n(t,e),r=a(o,e)}function r(t,e,n,a,r){function i(t){t.attr("class","alertBounds").attr("x",function(t){return e(t.startTimestamp)}).attr("y",function(){return n(a)}).attr("height",function(t){return 185}).attr("width",function(t){return e(t.endTimestamp)-e(t.startTimestamp)})}var o=t.select("g.alertHolder").selectAll("rect.alertBounds").data(r);o.call(i),o.enter().append("rect").call(i),o.exit().remove()}var i=function(){function t(t,e,n){this.startTimestamp=t,this.endTimestamp=e,this.alertValue=n,this.startDate=new Date(t),this.endDate=new Date(e)}return t}();t.AlertBound=i,t.createAlertLine=n,t.extractAlertRanges=a,t.createAlertBoundsArea=r}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=angular.module("hawkular.charts"),n=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.UP="up",t.DOWN="down",t.UNKNOWN="unknown",t}();t.AvailStatus=n;var a=function(){function t(t,e,n,a,r,i,o){this.start=t,this.end=e,this.value=n,this.startDate=a,this.endDate=r,this.duration=i,this.message=o,this.duration=moment(e).from(moment(t),!0),this.startDate=new Date(t),this.endDate=new Date(e)}return t}();t.TransformedAvailDataPoint=a;var r=function(){function e(r){var i=this;this.restrict="E",this.replace=!0,this.scope={data:"=",startTimestamp:"@",endTimestamp:"@",timeLabel:"@",dateLabel:"@",noDataLabel:"@",chartTitle:"@"},this.link=function(o,s,c){function u(t){return"<div class='chartHover'>\n            <div class=\"info-item\">\n              <span class='chartHoverLabel'>Status:</span>\n              <span class='chartHoverValue'>"+t.value.toUpperCase()+"</span>\n            </div>\n            <div class=\"info-item before-separator\">\n              <span class='chartHoverLabel'>Duration:</span>\n              <span class='chartHoverValue'>"+t.duration+"</span>\n            </div>\n          </div>"}function l(){E&&H.selectAll("*").remove(),H=d3.select(s[0]),E=H.append("svg").attr("viewBox","0 0 760 150").attr("preserveAspectRatio","xMinYMin meet"),b=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return u(t)}),R=E.append("g").attr("width",N+P.left+P.right).attr("height",B).attr("transform","translate("+P.left+","+F+")"),R.append("defs").append("pattern").attr("id","diagonal-stripes").attr("patternUnits","userSpaceOnUse").attr("patternTransform","scale(0.7)").attr("width",4).attr("height",4).append("path").attr("d","M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr("stroke","#B6B6B6").attr("stroke-width",1.2),R.call(b)}function m(e){var n=[];L=+c.startTimestamp||d3.min(e,function(t){return t.start})||+moment().subtract(1,"hour"),e&&e.length>0&&(n[0]=L,n[1]=+moment(),y=d3.scale.linear().clamp(!0).rangeRound([70,0]).domain([0,175]),w=d3.svg.axis().scale(y).ticks(0).tickSize(0,0).orient("left"),A=d3.time.scale().range([0,N]).domain(n),D=d3.svg.axis().scale(A).tickSize(-70,0).orient("top").tickFormat(t.xAxisTimeFormats()))}function f(t){return t.value===n.UP.toString()}function d(t){return t.value===n.UNKNOWN.toString()}function p(t){function e(t,e){return t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0}var r=[],i=t.length;if(t.sort(e),t&&i>0&&t[0].timestamp){var o=(new Date).getTime();if(1===i){var s=t[0];r.push(new a(o-36e5,s.timestamp,n.UNKNOWN.toString())),r.push(new a(s.timestamp,o,s.value))}else for(var c=o,u=t.length;u>0;u--){if(L>=t[u-1].timestamp){r.push(new a(L,c,t[u-1].value));break}r.push(new a(t[u-1].timestamp,c,t[u-1].value)),c=t[u-1].timestamp}}return r}function h(){R.append("text").attr("class","availUpLabel").attr("x",-10).attr("y",25).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Up"),R.append("text").attr("class","availDownLabel").attr("x",-10).attr("y",55).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Down")}function v(t){function e(t){return V-o(0)+(f(t)||d(t)?0:35)}function n(t){return o(0)-(d(t)?15:50)}function a(t){return f(t)?"#54A24E":d(t)?"url(#diagonal-stripes)":"#D85054"}var r=(d3.min(t,function(t){return+t.start}),d3.max(t,function(t){return+t.end})),i=d3.time.scale().range([0,N]).domain([L,r]),o=d3.scale.linear().clamp(!0).range([V,0]).domain([0,4]);d3.svg.axis().scale(i).ticks(8).tickSize(13,0).orient("top");R.selectAll("rect.availBars").data(t).enter().append("rect").attr("class","availBars").attr("x",function(t){return i(+t.start)}).attr("y",function(t){return e(t)}).attr("height",function(t){return n(t)}).attr("width",function(t){return i(+t.end)-i(+t.start)}).attr("fill",function(t){return a(t)}).attr("opacity",function(){return.85}).on("mouseover",function(t,e){b.show(t,e)}).on("mouseout",function(){b.hide()}).on("mousedown",function(){var t=R.select(".brush").node(),e=new Event("mousedown");e.pageX=d3.event.pageX,e.clientX=d3.event.clientX,e.pageY=d3.event.pageY,e.clientY=d3.event.clientY,t.dispatchEvent(e)}).on("mouseup",function(){var t=R.select(".brush").node(),e=new Event("mouseup");e.pageX=d3.event.pageX,e.clientX=d3.event.clientX,e.pageY=d3.event.pageY,e.clientY=d3.event.clientY,t.dispatchEvent(e)}),R.append("line").attr("x1",0).attr("y1",70).attr("x2",655).attr("y2",70).attr("stroke-width",.5).attr("stroke","#D0D0D0"),h()}function g(){R.selectAll("g.axis").remove(),C=R.append("g").attr("class","x axis").call(D),R.append("g").attr("class","y axis").call(w)}function x(){function e(){R.classed("selecting",!0)}function n(){var e=k.extent(),n=Math.round(e[0].getTime()),a=Math.round(e[1].getTime()),i=a-n;i>=6e4&&(console.log("Drag: AvailTimeRangeChanged:"+e),r.$broadcast(t.EventNames.AVAIL_CHART_TIMERANGE_CHANGED.toString(),e)),T.call(k.clear())}k=d3.svg.brush().x(A).on("brushstart",e).on("brushend",n),T=R.append("g").attr("class","brush").call(k),T.selectAll(".resize").append("path"),T.selectAll("rect").attr("height",70)}var y,A,w,D,C,k,T,b,E,H,R,L=+c.startTimestamp,S=+c.endTimestamp,M=e._CHART_HEIGHT,P=(c.noDataLabel||"No Data",{top:10,right:5,bottom:5,left:90}),N=e._CHART_WIDTH-P.left-P.right,_=M-50,V=_-P.top-P.bottom,I=30,$=10,B=V+P.top-I-$,F=+I+$+P.top;o.$watchCollection("data",function(t){console.log("Avail Chart Data Changed"),t&&(i.transformedDataPoints=p(angular.fromJson(t)),o.render(i.transformedDataPoints))}),o.$watchGroup(["startTimestamp","endTimestamp"],function(t){console.log("Avail Chart Start/End Timestamp Changed"),L=t[0]||L,S=t[1]||S,o.render(i.transformedDataPoints)}),o.render=function(t){console.log("Starting Avail Chart Directive Render"),t&&t.length>0&&(console.group("Render Avail Chart"),console.time("availChartRender"),l(),m(t),g(),x(),v(t),console.timeEnd("availChartRender"),console.groupEnd())}}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$rootScope"],t},e._CHART_HEIGHT=150,e._CHART_WIDTH=750,e}();t.AvailabilityChartDirective=r,e.directive("availabilityChart",r.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=angular.module("hawkular.charts"),n=function(){function e(n){var a=this;this.restrict="E",this.replace=!0,this.scope={data:"=",showYAxisValues:"="},this.link=function(r,i,o){function s(){A&&w.selectAll("*").remove(),w=d3.select(i[0]),A=w.append("svg").attr("width",T+C.left+C.right).attr("height",E).attr("viewBox","0 0 760 50").attr("preserveAspectRatio","xMinYMin meet"),D=A.append("g").attr("transform","translate("+C.left+", 0)").attr("class","contextChart")}function c(n){console.log("dataPoints.length: "+n.length),h=d3.time.scale().range([0,T-10]).nice().domain([n[0].timestamp,n[n.length-1].timestamp]),v=d3.svg.axis().scale(h).ticks(5).tickSize(4,0).tickFormat(t.xAxisTimeFormats()).orient("bottom"),D.selectAll("g.axis").remove(),g=D.append("g").attr("class","x axis").attr("transform","translate(0,"+b+")").call(v);var a=d3.min(n,function(t){return t.avg}),r=d3.max(n,function(t){return t.avg});r+=.03*r,a-=.05*a,f=d3.scale.linear().rangeRound([e._CHART_HEIGHT-10,0]).nice().domain([a,r]);var i=m?2:0;d=d3.svg.axis().scale(f).ticks(i).tickSize(4,0).orient("left"),p=D.append("g").attr("class","y axis").call(d);var o=d3.svg.area().interpolate("cardinal").defined(function(t){return!t.empty}).x(function(t){return h(t.timestamp)}).y0(function(t){return b}).y1(function(t){return f(t.avg)}),s=d3.svg.line().interpolate("cardinal").defined(function(t){return!t.empty}).x(function(t){return h(t.timestamp)}).y(function(t){return f(t.avg)}),c=D.selectAll("path.contextLine").data([n]);c.attr("class","contextLine").transition().attr("d",s),c.enter().append("path").attr("class","contextLine").transition().attr("d",s),c.exit().remove();var u=D.append("g").attr("class","context");u.append("path").datum(n).transition().duration(500).attr("class","contextArea").attr("d",o)}function u(){function e(){D.classed("selecting",!0)}function a(){var e=x.extent(),a=Math.round(e[0].getTime()),r=Math.round(e[1].getTime()),i=r-a;i>=6e4&&(console.log("Drag: ContextChartTimeRangeChanged:"+e),n.$broadcast(t.EventNames.CONTEXT_CHART_TIMERANGE_CHANGED.toString(),e))}x=d3.svg.brush().x(h).on("brushstart",e).on("brushend",a),g.append("g").selectAll("rect").attr("y",0).attr("height",b-10),y=D.append("g").attr("class","brush").call(x),y.selectAll(".resize").append("path"),y.selectAll("rect").attr("height",b+17)}function l(t){return t?t.map(function(t){var e=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:e,value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}var m,f,d,p,h,v,g,x,y,A,w,D,C={top:0,right:5,bottom:5,left:90},k=e._CHART_HEIGHT,T=e._CHART_WIDTH-C.left-C.right,b=k-C.top-C.bottom,E=b+C.top;"undefined"!=typeof o.showYAxisValues&&(m="true"===o.showYAxisValues),r.$watchCollection("data",function(t){console.log("Context Chart Data Changed"),t&&(a.dataPoints=l(angular.fromJson(t)),r.render(a.dataPoints))}),r.render=function(t){t&&t.length>0&&(console.group("Render Context Chart"),console.time("contextChartRender"),s(),c(t),u(),console.timeEnd("contextChartRender"),console.groupEnd())}}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$rootScope"],t},e._CHART_WIDTH=750,e._CHART_HEIGHT=50,e}();t.ContextChartDirective=n,e.directive("hawkularContextChart",n.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.CHART_TIMERANGE_CHANGED=new t("ChartTimeRangeChanged"),t.AVAIL_CHART_TIMERANGE_CHANGED=new t("AvailChartTimeRangeChanged"),t.CONTEXT_CHART_TIMERANGE_CHANGED=new t("ContextChartTimeRangeChanged"),t}();t.EventNames=e}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=!1,n=10,a=25;angular.module("hawkular.charts").directive("hawkularChart",["$rootScope","$http","$interval","$log",function(r,i,o,s){function c(c,u,l){function m(t){return Q(t.timestamp)}function f(){return vt}function d(){return f()<=Wt}function p(){ot&&st.selectAll("*").remove(),st=d3.select(u[0]),ot=st.append("svg").attr("viewBox","0 0 760 "+(ht+a)).attr("preserveAspectRatio","xMinYMin meet"),t.createSvgDefs(ot),ct=ot.append("g").attr("width",zt+Yt.left+Yt.right).attr("height",Kt).attr("transform","translate("+Yt.left+","+qt+")"),nt=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t,e){return w(t,e)}),ct.call(nt),ct.append("g").attr("class","alertHolder"),Qt=!0}function h(e){e&&(mt=d3.max(e.map(function(e){return t.isEmptyDataPoint(e)?0:e.avg||e.value})),ft=d3.min(e.map(function(e){return t.isEmptyDataPoint(e)?void 0:e.avg||e.value}))),ut=Ut?0:.95*ft,lt=mt+.2*(mt-ft),Tt&&(lt=Math.max(lt,1.2*Tt),ut=Math.min(ut,.95*Tt)),lt=lt||ut?lt:n}function v(e){var n,a=20;e.length>0&&(d()?(zt=250,n=3,J=e.slice(e.length-a,e.length)):(n=9,J=e),h(e),j=function(){return zt/J.length-Zt},K=function(t){return 0===t||t===J.length-1?j()/2:j()},q=function(t,e){return Q(t.timestamp)-(0===e?0:j()/2)},Z=d3.scale.linear().clamp(!0).rangeRound([Ot,0]).domain([ut,lt]),tt=d3.svg.axis().scale(Z).ticks(5).tickSize(4,4,0).orient("left"),Q=d3.time.scale().range([0,zt]).domain(d3.extent(J,function(t){return t.timestamp})),it=d3.time.scale().range([0,zt]).domain(d3.extent(J,function(t){return t.timestamp})),et=d3.svg.axis().scale(Q).ticks(n).tickFormat(t.xAxisTimeFormats()).tickSize(4,4,0).orient("bottom"))}function g(e){function a(){var n,a,r,i,o=[],s=[];return e.forEach(function(e){n=d3.max(e.values.map(function(e){return t.isEmptyDataPoint(e)?0:e.avg})),o.push(n),a=d3.min(e.values.map(function(e){return t.isEmptyDataPoint(e)?Number.MAX_VALUE:e.avg})),s.push(a)}),r=d3.max(o),i=d3.min(s),[i,r]}var r,i,o=a();return mt=o[1],ft=o[0],ut=Ut?0:ft-.05*ft,Tt?(r=1.2*Tt,i=mt+.2*(mt-ft),lt=r>i?r:i):lt=mt+.2*(mt-ft),[ut,lt||ut?lt:n]}function x(e){var n=9;if(e&&e[0]&&e[0].values){var a=g(e);ut=a[0],lt=a[1],Z=d3.scale.linear().clamp(!0).rangeRound([Ot,0]).domain([ut,lt]),tt=d3.svg.axis().scale(Z).ticks(5).tickSize(4,4,0).orient("left"),Q=d3.time.scale().range([0,zt]).domain([d3.min(e,function(t){return d3.min(t.values,function(t){return t.timestamp})}),d3.max(e,function(t){return d3.max(t.values,function(t){return t.timestamp})})]),et=d3.svg.axis().scale(Q).ticks(n).tickFormat(t.xAxisTimeFormats()).tickSize(4,4,0).orient("bottom")}}function y(t,e,n,a,r){void 0===r&&(r=60);var o={headers:{"Hawkular-Tenant":wt},params:{start:n,end:a,buckets:r}};if(n>=a&&s.log("Start date was after end date"),t&&Dt&&e){var u=Dt.split("-");i.get(t+"/"+u[0]+"s/"+e+"/"+(u[1]||"data"),o).success(function(t){dt=A(t),c.render(dt,pt)}).error(function(t,e){s.error("Error Loading Chart Data:"+e+", "+t)})}}function A(t){return t?t.map(function(t){var e=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:e,date:new Date(e),value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}function w(e,n){var a,r,i,o=e.timestamp,s=moment(e.timestamp).format(gt);return n>0&&(r=J[n-1].timestamp,i=moment(o).from(moment(r),!0)),a=t.isEmptyDataPoint(e)?"<div class='chartHover'>\n                <small class='chartHoverLabel'>"+Pt+"</small>\n                <div><small><span class='chartHoverLabel'>"+Nt+"</span><span>: </span><span class='chartHoverValue'>"+i+"</span></small> </div>\n                <hr/>\n                <div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+s+"</span></small></div>\n                </div>":t.isRawMetric(e)?"<div class='chartHover'>\n                <div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+s+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Nt+"</span><span>: </span><span class='chartHoverValue'>"+i+"</span></small></div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Mt+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(e.value,2)+"</span></small> </div>\n                  </div> ":"<div class='chartHover'>\n                    <div class=\"info-item\">\n                      <span class='chartHoverLabel'>"+$t+":</span>\n                      <span class='chartHoverValue'>"+s+"</span>\n                    </div>\n                    <div class=\"info-item before-separator\">\n                      <span class='chartHoverLabel'>"+Nt+":</span>\n                      <span class='chartHoverValue'>"+i+"</span>\n                    </div>\n                    <div class=\"info-item separator\">\n                      <span class='chartHoverLabel'>"+Vt+":</span>\n                      <span class='chartHoverValue'>"+d3.round(e.max,2)+"</span>\n                    </div>\n                    <div class=\"info-item\">\n                      <span class='chartHoverLabel'>"+It+":</span>\n                      <span class='chartHoverValue'>"+d3.round(e.avg,2)+"</span>\n                    </div>\n                    <div class=\"info-item\">\n                      <span class='chartHoverLabel'>"+_t+":</span>\n                      <span class='chartHoverValue'>"+d3.round(e.min,2)+"</span>\n                    </div>\n                  </div> "}function D(e){function n(n){n.attr("class",a).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}).transition().attr("x",function(t,e){return q(t,e)}).attr("width",function(t,e){return K(e)}).attr("y",function(e){return t.isEmptyDataPoint(e)?0:Z(e.avg)}).attr("height",function(e){return Ot-Z(t.isEmptyDataPoint(e)?Z(lt):e.avg)}).attr("opacity",e?".6":"1").attr("fill",function(n,a){return t.isEmptyDataPoint(n)?"url(#noDataStripes)":e?"#D3D3D6":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return"0"}).attr("data-hawkular-value",function(t){return t.avg})}var a=e?"leaderBar":"histogram",r=ct.selectAll("rect."+a).data(J);r.call(n),r.enter().append("rect").call(n),r.exit().remove(),Gt?ct.selectAll(".histogramTopStem, .histogramBottomStem, .histogramTopCross, .histogramBottomCross").remove():R(e)}function C(e){e.attr("class",function(t){return t.min===t.max?"singleValue":"high"}).attr("x",function(t,e){return q(t,e)}).attr("y",function(t){return Z(isNaN(t.max)?ut:t.max)}).attr("height",function(e){return t.isEmptyDataPoint(e)?0:Z(e.avg)-Z(e.max)||2}).attr("width",function(t,e){return K(e)}).attr("opacity",.9).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()})}function k(e){e.attr("class","low").attr("x",function(t,e){return q(t,e)}).attr("y",function(t){return isNaN(t.avg)?Ot:Z(t.avg)}).attr("height",function(e){return t.isEmptyDataPoint(e)?0:Z(e.min)-Z(e.avg)}).attr("width",function(t,e){return K(e)}).attr("opacity",.9).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()})}function T(e){e.attr("class","histogramTopStem").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return ee})}function b(e){e.filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","histogramBottomStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Z(t.avg)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return ee})}function E(e){e.filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","histogramTopCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return ee})}function H(e){e.filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","histogramBottomCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Z(t.min)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return ee})}function R(t){if(t){var e=ct.selectAll("rect.high, rect.singleValue").data(J);e.call(C),e.enter().append("rect").call(C),e.exit().remove();var n=ct.selectAll("rect.low").data(J);n.call(k),n.enter().append("rect").call(k),n.exit().remove()}else{var a=ct.selectAll(".histogramTopStem").data(J);a.call(T),a.enter().append("line").call(T),a.exit().remove();var r=ct.selectAll(".histogramBottomStem").data(J);r.call(b),r.enter().append("line").call(b),r.exit().remove();var i=ct.selectAll(".histogramTopCross").data(J);i.call(E),i.enter().append("line").call(E),i.exit().remove();var o=ct.selectAll(".histogramBottomCross").data(J);o.call(H),o.enter().append("line").call(H),o.exit().remove()}}function L(){var e=d3.svg.line().interpolate(bt).defined(function(e){return!t.isEmptyDataPoint(e)}).x(function(t){return Q(t.timestamp)}).y(function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}),n=ct.selectAll("path.metricLine").data([J]);n.attr("class","metricLine").transition().attr("d",e),n.enter().append("path").attr("class","metricLine").transition().attr("d",e),n.exit().remove()}function S(t){var e=d3.scale.category10(),n=0;t?(ct.selectAll("path[id^='multiLine']")[0].forEach(function(e){var n=!1;t.forEach(function(t){t.keyHash=t.keyHash||"multiLine"+O(t.key),e.getAttribute("id")===t.keyHash&&(n=!0)}),n||e.remove()}),t.forEach(function(t){if(t&&t.values){t.keyHash=t.keyHash||"multiLine"+O(t.key);var a=ct.selectAll("path#"+t.keyHash).data([t.values]);a.attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color||e(n++)}).transition().attr("d",$("linear")),a.enter().append("path").attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:e(n++)}).transition().attr("d",$("linear")),a.exit().remove()}})):s.warn("No multi-data set for multiline chart")}function M(){var e=d3.svg.area().interpolate(bt).defined(function(e){return!t.isEmptyDataPoint(e)}).x(function(t){return m(t)}).y(function(e){return Z(t.isRawMetric(e)?e.value:e.max)}).y0(function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}),n=d3.svg.area().interpolate(bt).defined(function(e){return!t.isEmptyDataPoint(e)}).x(function(t){return m(t)}).y(function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}).y0(function(t){return Gt?Ot:Z(t.min)}),a=d3.svg.area().interpolate(bt).defined(function(e){return!t.isEmptyDataPoint(e)}).x(function(t){return m(t)}).y(function(e){return Z(t.isRawMetric(e)?e.value:e.min)}).y0(function(){return Ot});if(!Gt){var r=ct.selectAll("path.highArea").data([J]);r.attr("class","highArea").attr("d",e),r.enter().append("path").attr("class","highArea").attr("d",e),r.exit().remove();var i=ct.selectAll("path.lowArea").data([J]);i.attr("class","lowArea").attr("d",a),i.enter().append("path").attr("class","lowArea").attr("d",a),i.exit().remove()}var o=ct.selectAll("path.avgArea").data([J]);o.attr("class","avgArea").transition().attr("d",n),o.enter().append("path").attr("class","avgArea").transition().attr("d",n),o.exit().remove()}function P(){if(Gt)ct.selectAll(".highDot, .lowDot").remove();else{var e=ct.selectAll(".highDot").data(J);e.attr("class","highDot").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),e.enter().append("circle").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","highDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),e.exit().remove();var n=ct.selectAll(".lowDot").data(J);n.attr("class","lowDot").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),n.enter().append("circle").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","lowDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),n.exit().remove()}var a=ct.selectAll(".avgDot").data(J);a.attr("class","avgDot").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),a.enter().append("circle").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","avgDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),a.exit().remove()}function N(){var e=ct.selectAll(".scatterLineTopStem").data(J);e.attr("class","scatterLineTopStem").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.avg)}).attr("stroke",function(t){return"#000"}),e.enter().append("line").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","scatterLineTopStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.avg)}).attr("stroke",function(t){return"#000"}),e.exit().remove();var n=ct.selectAll(".scatterLineBottomStem").data(J);n.attr("class","scatterLineBottomStem").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Z(t.avg)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"#000"}),n.enter().append("line").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","scatterLineBottomStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Z(t.avg)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"#000"}),n.exit().remove();var a=ct.selectAll(".scatterLineTopCross").data(J);a.attr("class","scatterLineTopCross").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),a.enter().append("line").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","scatterLineTopCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),a.exit().remove();var r=ct.selectAll(".scatterLineBottomCross").data(J);r.attr("class","scatterLineBottomCross").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Z(t.min)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),r.enter().append("line").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","scatterLineBottomCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Z(t.min)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),r.exit().remove();var i=ct.selectAll(".scatterDot").data(J);i.attr("class","scatterDot").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),i.enter().append("circle").filter(function(e){return!t.isEmptyDataPoint(e)}).attr("class","scatterDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(e){return Z(t.isRawMetric(e)?e.value:e.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),i.exit().remove()}function _(){if(Z){var t=ct.selectAll("g.grid.y_grid");t[0].length||(t=ct.append("g").classed("grid y_grid",!0)),t.call(d3.svg.axis().scale(Z).orient("left").ticks(10).tickSize(-zt,0).tickFormat(""))}}function V(){function t(t){t.transition().delay(500).duration(2e3).attr("opacity",1)}if(tt){ct.selectAll("g.axis").remove();ct.append("g").attr("class","x axis").attr("transform","translate(0,"+Ot+")").attr("opacity",.3).call(et).call(t),ct.append("g").attr("class","y axis").attr("opacity",.3).call(tt).call(t),ct.append("text").attr("class","yAxisUnitsLabel").attr("transform","rotate(-90),translate(-10,-50)").attr("x",-ht/2).style("text-anchor","start").text("NONE"===l.yAxisUnits?"":l.yAxisUnits).attr("opacity",.3).call(t)}}function I(e){var n=e||"monotone",a=d3.svg.line().interpolate(n).defined(function(e){return!t.isEmptyDataPoint(e)}).x(function(t){return Q(t.timestamp)}).y(function(e){return Z(t.isRawMetric(e)?e.value:e.avg)});return a}function $(e){var n=e||"monotone",a=d3.svg.line().interpolate(n).defined(function(e){return!t.isEmptyDataPoint(e)}).x(function(t){return Q(t.timestamp)}).y(function(e){return Z(t.isRawMetric(e)?e.value:e.avg)});return a}function B(){if("bar"===St||"scatterline"===St){var t=ct.selectAll(".barAvgLine").data([J]);t.attr("class","barAvgLine").attr("d",I("monotone")),t.enter().append("path").attr("class","barAvgLine").attr("d",I("monotone")),t.exit().remove()}}function F(){function e(){ct.classed("selecting",!0)}function n(){var e=at.extent(),n=Math.round(e[0].getTime()),a=Math.round(e[1].getTime()),i=a-n;ct.classed("selecting",!d3.event.target.empty()),i>=6e4&&r.$broadcast(t.EventNames.CHART_TIMERANGE_CHANGED.toString(),e),rt.call(at.clear())}rt=ct.selectAll("g.brush"),rt.empty()&&(rt=ct.append("g").attr("class","brush")),at=d3.svg.brush().x(Q).on("brushstart",e).on("brushend",n),rt.call(at),rt.selectAll(".resize").append("path"),rt.selectAll("rect").attr("height",Ot)}function G(t){t&&ct.append("path").datum(t).attr("class","prevRangeAvgLine").style("stroke-dasharray","9,3").attr("d",I("linear"))}function U(t){t&&ct.selectAll(".annotationDot").data(t).enter().append("circle").attr("class","annotationDot").attr("r",5).attr("cx",function(t){return Q(t.timestamp)}).attr("cy",function(){return Ot-Z(lt)}).style("fill",function(t){return"1"===t.severity?"red":"2"===t.severity?"yellow":"white"})}function Y(t){var e=1,n=ct.selectAll(".dataPointDot").data(t);n.attr("class","dataPointDot").attr("r",e).attr("cx",function(t){return Q(t.timestamp)}).attr("cy",function(t){return t.avg?Z(t.avg):-9999999}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),n.enter().append("circle").attr("class","dataPointDot").attr("r",e).attr("cx",function(t){return Q(t.timestamp)}).attr("cy",function(t){return t.avg?Z(t.avg):-9999999}).on("mouseover",function(t,e){nt.show(t,e)}).on("mouseout",function(){nt.hide()}),n.exit().remove();
}function z(){Et=Date.now(),Ht=moment().subtract(Ct,"seconds").valueOf(),y(yt,At,Ht,Et,60)}function X(t){switch(t){case"rhqbar":D(!0);break;case"histogram":D(!1);break;case"line":L();break;case"hawkularmetric":console.info("DEPRECATION WARNING: The chart type hawkularmetric has been deprecated and will be removed in a future release. Please use the line chart type in its place"),L();break;case"multiline":S(W);break;case"area":M();break;case"scatter":P();break;case"scatterline":N();break;default:s.warn("chart-type is not valid. Must be in [rhqbar,line,area,multiline,scatter,scatterline,histogram] chart type: "+t)}}function O(t){var e,n,a,r=0;if(0==t.length)return r;for(e=0,a=t.length;a>e;e++)n=t.charCodeAt(e),r=(r<<5)-r+n,r|=0;return r}var W,J,j,K,q,Z,Q,tt,et,nt,at,rt,it,ot,st,ct,ut,lt,mt,ft,dt,pt,ht=250,vt=750,gt="MM/DD/YYYY h:mm a",xt=[],yt=l.metricUrl,At=l.metricId||"",wt=l.metricTenantId||"",Dt=l.metricType||"gauge",Ct=+l.timeRangeInSeconds||43200,kt=+l.refreshIntervalInSeconds||3600,Tt=+l.alertValue,bt=l.interpolation||"monotone",Et=Date.now(),Ht=Et-Ct,Rt=[],Lt=[],St=l.chartType||"hawkularline",Mt=l.singleValueLabel||"Raw Value",Pt=l.noDataLabel||"No Data",Nt=l.durationLabel||"Interval",_t=l.minLabel||"Min",Vt=l.maxLabel||"Max",It=l.avgLabel||"Avg",$t=l.timestampLabel||"Timestamp",Bt=!0,Ft=!1,Gt=!1,Ut=!1,Yt={top:10,right:5,bottom:5,left:90},zt=vt-Yt.left-Yt.right,Xt=ht-50,Ot=Xt-Yt.top-Yt.bottom,Wt=600,Jt=30,jt=10,Kt=Ot+Yt.top-Jt-jt+Yt.bottom,qt=+Jt+jt+Yt.top,Zt=2,Qt=!1;xt=l.data,Ft=l.showDataPoints,Rt=l.previousRangeData,Lt=l.annotationData;var te,ee=.6;c.$watchCollection("data",function(t){t&&(dt=angular.fromJson(t),c.render(dt,pt))}),c.$watch("multiData",function(t){t&&(W=angular.fromJson(t),c.render(dt,pt))},!0),c.$watch("previousRangeData",function(t){t&&(pt=angular.fromJson(t),c.render(dt,pt))},!0),c.$watch("annotationData",function(t){t&&(Lt=angular.fromJson(t),c.render(dt,pt))},!0),c.$watchGroup(["alertValue","chartType","hideHighLowValues","useZeroMinValue","showAvgLine"],function(t){Tt=t[0]||Tt,St=t[1]||St,Gt="undefined"!=typeof t[2]?t[2]:Gt,Ut="undefined"!=typeof t[3]?t[3]:Ut,Bt="undefined"!=typeof t[4]?t[4]:Bt,c.render(dt,pt)}),c.$watchGroup(["metricUrl","metricId","metricType","metricTenantId","timeRangeInSeconds"],function(t){yt=t[0]||yt,At=t[1]||At,Dt=t[2]||At,wt=t[3]||wt,Ct=t[4]||Ct,z()}),c.$watch("refreshIntervalInSeconds",function(t){t&&(kt=+t,o.cancel(te),te=o(function(){z()},1e3*kt))}),c.$on("$destroy",function(){o.cancel(te)}),c.$on("DateRangeDragChanged",function(t,e){c.$emit("GraphTimeRangeChangedEvent",e)}),c.render=function(n,a){if(n||W){if(e&&console.group("Render Chart"),e&&console.time("chartRender"),Qt||p(),n&&v(n),W&&x(W),Tt&&Tt>ut&&lt>Tt){var r=t.extractAlertRanges(J,Tt);t.createAlertBoundsArea(ct,Q,Z,lt,r)}F(),_(),X(St),Ft&&Y(J),G(a),V(),Bt&&B(),Tt&&Tt>ut&&lt>Tt&&t.createAlertLine(ct,Q,Z,J,Tt),Lt&&U(Lt),e&&console.timeEnd("chartRender"),e&&console.groupEnd("Render Chart")}}}return{link:c,restrict:"E",replace:!0,scope:{data:"=",multiData:"=",metricUrl:"@",metricId:"@",metricType:"@",metricTenantId:"@",startTimestamp:"@",endTimestamp:"@",timeRangeInSeconds:"@",refreshIntervalInSeconds:"@",previousRangeData:"@",annotationData:"@",showDataPoints:"=",alertValue:"@",interpolation:"@",chartType:"@",yAxisUnits:"@",useZeroMinValue:"=",chartHoverDateFormat:"@",chartHoverTimeFormat:"@",singleValueLabel:"@",noDataLabel:"@",durationLabel:"@",minLabel:"@",maxLabel:"@",avgLabel:"@",timestampLabel:"@",showAvgLine:"=",hideHighLowValues:"="}}}])}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=15,n=angular.module("hawkular.charts"),a=function(){function n(a){var r=this;this.restrict="E",this.replace=!0,this.scope={data:"=",showYAxisValues:"=",showXAxisValues:"=",alertValue:"@"},this.link=function(a,i,o){function s(){x&&y.selectAll("*").remove(),y=d3.select(i[0]),x=y.append("svg").attr("width",k+D.left+D.right).attr("height",b).attr("viewBox","0 0 "+(k+D.left+D.right)+" "+(T+D.top+D.bottom+e)).attr("preserveAspectRatio","xMinYMin meet"),A=x.append("g").attr("transform","translate("+D.left+","+D.top+")").attr("class","sparkline")}function c(a){h=d3.time.scale().range([0,k-10]).nice().domain([a[0].timestamp,a[a.length-1].timestamp]);var r=l?3:0;v=d3.svg.axis().scale(h).ticks(r).tickSize(4,0).tickFormat(t.xAxisTimeFormats()).orient("bottom"),A.selectAll("g.axis").remove();var i=d3.min(a,function(t){return t.avg}),o=d3.max(a,function(t){return t.avg});o+=.03*o,i-=.05*i,f=d3.scale.linear().rangeRound([n._CHART_HEIGHT-e,0]).domain([i,o]);var s=m?2:0;d=d3.svg.axis().scale(f).ticks(s).tickSize(3,0).orient("left");var c="basis",u=d3.svg.area().interpolate(c).defined(function(t){return!t.empty}).x(function(t){return h(t.timestamp)}).y0(function(t){return n._CHART_HEIGHT-e}).y1(function(t){return f(t.avg)}),x=d3.svg.line().interpolate(c).defined(function(t){return!t.empty}).x(function(t){return h(t.timestamp)}).y(function(t){return f(t.avg)-2}),y=A.selectAll("path.sparklineLine").data([a]);y.attr("class","sparklineLine").transition().attr("d",x),y.enter().append("path").attr("class","sparklineLine").transition().attr("d",x),y.exit().remove();var D=A.append("g").attr("class","sparkline");D.append("path").datum(a).transition().duration(500).attr("class","sparklineArea").attr("d",u),p=A.append("g").attr("class","y axis").call(d),g=A.append("g").attr("class","x axis").attr("transform","translate(0,"+T+")").call(v),w&&w>=i&&o>=w&&t.createAlertLine(A,h,f,a,w)}function u(t){return t?t.map(function(t){var e=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:e,value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}var l,m,f,d,p,h,v,g,x,y,A,w,D={top:10,right:5,bottom:5,left:45},C=n._CHART_HEIGHT,k=n._CHART_WIDTH-D.left-D.right,T=C-D.top-D.bottom,b=T+D.top;"undefined"!=typeof o.alertValue&&(w=+o.alertValue),"undefined"!=typeof o.showXAxisValues&&(l="true"===o.showXAxisValues),"undefined"!=typeof o.showYAxisValues&&(m="true"===o.showYAxisValues),a.$watchCollection("data",function(t){console.log("Sparkline Chart Data Changed"),t&&(r.dataPoints=u(angular.fromJson(t)),a.render(r.dataPoints))}),a.$watchCollection("alertValue",function(t){console.log("Sparkline AlertValue Changed"),t&&(w=t,r.dataPoints&&a.render(r.dataPoints))}),a.render=function(t){t&&t.length>0&&(console.group("Render Sparkline Chart"),console.time("SparklineChartRender"),s(),c(t),console.timeEnd("SparklineChartRender"),console.groupEnd())}}}return n.Factory=function(){var t=function(t){return new n(t)};return t.$inject=["$rootScope"],t},n._CHART_WIDTH=300,n._CHART_HEIGHT=80,n}();t.SparklineChartDirective=a,n.directive("hawkularSparklineChart",a.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";function e(t){return t.empty}function n(t){return"undefined"==typeof t.avg}function a(){return d3.time.format.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]])}function r(t){var e=t.append("defs");e.append("pattern").attr("id","noDataStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").append("path").attr("d","M 0 0 6 0").attr("style","stroke:#CCCCCC; fill:none;"),e.append("pattern").attr("id","unknownStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#2E9EC2; fill:none;").append("path").attr("d","M 0 0 6 0"),e.append("pattern").attr("id","downStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#ff8a9a; fill:none;").append("path").attr("d","M 0 0 6 0")}t.isEmptyDataPoint=e,t.isRawMetric=n,t.xAxisTimeFormats=a,t.createSvgDefs=r}(Charts||(Charts={}));