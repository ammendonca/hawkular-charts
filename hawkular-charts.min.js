angular.module("hawkular.charts",[]);var Charts;!function(t){"use strict";var a=function(){function t(t,a,n,e,r,i,o){this.start=t,this.end=a,this.value=n,this.startDate=e,this.endDate=r,this.duration=i,this.message=o,this.duration=moment(a).from(moment(t),!0),this.startDate=new Date(t),this.endDate=new Date(a)}return t}();t.TransformedAvailDataPoint=a;var n=(angular.module("hawkular.charts").directive("availabilityChart",function(){return new t.AvailabilityChartDirective}),function(){function t(){this.restrict="E",this.replace=!0,this.scope={data:"=",startTimestamp:"@",endTimestamp:"@",chartHeight:"@",timeLabel:"@",dateLabel:"@",noDataLabel:"@",chartTitle:"@"},this.link=function(t,n,e){function r(t){return"<div class='chartHover'><div><small><span class='chartHoverLabel'>Status: </span><span>: </span><span class='chartHoverValue'>"+t.value.toUpperCase()+"</span></small></div>\n          <div><small><span class='chartHoverLabel'>Duration</span><span>: </span><span class='chartHoverValue'>"+t.duration+"</span></small> </div>"}function i(){D&&k.selectAll("*").remove(),k=d3.select(n[0]),D=k.append("svg").attr("viewBox","0 0 760 150").attr("preserveAspectRatio","xMinYMin meet"),b=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return r(t)}),L=D.append("g").attr("width",S+T.left+T.right).attr("height",$).attr("transform","translate("+T.left+","+U+")"),L.append("defs").append("pattern").attr("id","diagonal-stripes").attr("patternUnits","userSpaceOnUse").attr("patternTransform","scale(0.7)").attr("width",4).attr("height",4).append("path").attr("d","M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr("stroke","#B6B6B6").attr("stroke-width",1.2),L.call(b)}function o(t){var a=[];A=+e.startTimestamp||d3.min(t,function(t){return t.start})||+moment().subtract(1,"hour"),t&&(a[0]=A,a[1]=+moment(),h=d3.scale.linear().clamp(!0).rangeRound([70,0]).domain([0,175]),g=d3.svg.axis().scale(h).ticks(0).tickSize(0,0).orient("left"),v=d3.time.scale().range([0,S]).domain(a),y=d3.svg.axis().scale(v).tickSize(-70,0).orient("top").tickFormat(d3.time.format.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]])))}function s(t){return"up"===t.value}function u(t){return"unknown"===t.value}function c(t){var n=[],e=t.length;if(t&&e>0&&t[0].timestamp){var r=(new Date).getTime();if(1===e){var i=t[0];n.push(new a(r-36e5,i.timestamp,"unknown")),n.push(new a(i.timestamp,r,i.value))}else{var o,s;for(o=r,s=t.length;s>0;s--)if(!(t[s-1].timestamp>+moment())){if(A>=t[s-1].timestamp){n.push(new a(A,o,t[s-1].value));break}n.push(new a(t[s-1].timestamp,o,t[s-1].value)),o=t[s-1].timestamp}}}return n}function l(){L.append("text").attr("class","availUpLabel").attr("x",-10).attr("y",25).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Up"),L.append("text").attr("class","availDownLabel").attr("x",-10).attr("y",55).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Down")}function m(t){function a(t){return R-o(0)+(s(t)||u(t)?0:35)}function n(t){return o(0)-(u(t)?15:50)}function e(t){return s(t)?"#54A24E":u(t)?"url(#diagonal-stripes)":"#D85054"}var r=(d3.min(t,function(t){return+t.start}),d3.max(t,function(t){return+t.end})),i=d3.time.scale().range([0,S]).domain([A,r]),o=d3.scale.linear().clamp(!0).range([R,0]).domain([0,4]);d3.svg.axis().scale(i).ticks(8).tickSize(13,0).orient("top");L.selectAll("rect.availBars").data(t).enter().append("rect").attr("class","availBars").attr("x",function(t){return i(+t.start)}).attr("y",function(t){return a(t)}).attr("height",function(t){return n(t)}).attr("width",function(t){return i(+t.end)-i(+t.start)}).attr("fill",function(t){return e(t)}).on("mouseover",function(t,a){b.show(t,a)}).on("mouseout",function(){b.hide()}),L.append("line").attr("x1",0).attr("y1",70).attr("x2",655).attr("y2",70).attr("stroke-width",.5).attr("stroke","#D0D0D0"),l()}function d(){var t;L.selectAll("g.axis").remove(),t=L.append("g").attr("class","x axis").call(y),L.append("g").attr("class","y axis").call(g)}function p(){function a(){L.classed("selecting",!0)}function n(){x.extent()}function e(){var a=x.extent(),n=Math.round(a[0].getTime()),e=Math.round(a[1].getTime()),r=e-n>=6e4;L.classed("selecting",!d3.event.target.empty()),r&&t.$emit("DateRangeChanged",a)}x=d3.svg.brush().x(w).on("brushstart",a).on("brush",n).on("brushend",e)}var f,h,v,g,y,x,b,w,D,k,L,A=+e.startTimestamp,C=+e.endTimestamp,H=+e.chartHeight||150,T=(e.noDataLabel||"No Data",{top:10,right:5,bottom:5,left:90}),S=750-T.left-T.right,M=H-50,R=M-T.top-T.bottom,V=30,E=10,$=R+T.top-V-E,U=+V+E+T.top;t.$watchCollection("data",function(a){console.debug("Avail Chart Data Changed"),a&&(f=c(angular.fromJson(a)),t.render(f))}),t.$watchGroup(["startTimestamp","endTimestamp"],function(a){console.debug("Avail Chart Start/End Timestamp Changed"),A=a[0]||A,C=a[1]||C,t.render(f)}),t.render=function(t){console.debug("Starting Avail Chart Directive Render"),console.group("Render Avail Chart"),t&&(console.time("availChartRender"),i(),o(t),p(),d(),m(t),console.timeEnd("availChartRender")),console.groupEnd()}}}return t}());t.AvailabilityChartDirective=n}(Charts||(Charts={}));var Charts;!function(t){"use strict";var a=!1,n=10,e=function(){function t(t,a,n){this.startTimestamp=t,this.endTimestamp=a,this.alertValue=n,this.startDate=new Date(t),this.endDate=new Date(a)}return t}();angular.module("hawkular.charts").directive("hawkularChart",["$rootScope","$http","$interval","$log",function(t,r,i,o){function s(t,s,u){function c(t){return j(t.timestamp)+Z()/2}function l(){return 760}function m(){return l()<=qt}function d(){et&&rt.selectAll("*").remove(),rt=d3.select(s[0]),et=rt.append("svg").attr("viewBox","0 0 760 250").attr("preserveAspectRatio","xMinYMin meet"),D(et),W=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t,a){return w(t,a)}),it=et.append("g").attr("width",Jt+zt.left+zt.right).attr("height",Zt).attr("transform","translate("+zt.left+","+_t+")"),it.call(W)}function p(t){function a(){var t,a,n,e,r=[],i=[];return Ct.forEach(function(n){t=d3.max(n.map(function(t){return t.empty?0:t.avg||t.value})),r.push(t),a=d3.min(n.map(function(t){return t.empty?Number.MAX_VALUE:t.avg||t.value})),i.push(a)}),n=d3.max(r),e=d3.min(i),[e,n]}var e,r;if(Ct){var i=a();ut=i[1],ct=i[0]}t&&(ut=d3.max(t.map(function(t){return t.empty?0:t.avg||t.value})),ct=d3.min(t.map(function(t){return t.empty?void 0:t.avg||t.value}))),ot=Ft?0:ct-.05*ct,xt?(e=1.2*xt,r=ut+.2*(ut-ct),st=e>r?e:r):st=ut+.2*(ut-ct),st=st||ot?st:n}function f(t){var a,n,e=20;t.length>0&&(m()?(Jt=250,a=3,n=2,X=t.slice(t.length-e,t.length)):(a=9,n=5,X=t),p(t),Z=function(){return Jt/X.length-jt},_=d3.scale.linear().clamp(!0).rangeRound([Yt,0]).domain([ot,st]),K=d3.svg.axis().scale(_).tickSubdivide(1).ticks(5).tickSize(4,4,0).orient("left"),j=d3.time.scale().range([0,Jt]).domain(d3.extent(X,function(t){return t.timestamp})),At?nt=d3.time.scale().range([0,Jt]).domain(d3.extent(At,function(t){return t.timestamp})):at=d3.time.scale().range([0,Jt]).domain(d3.extent(X,function(t){return t.timestamp})),Q=d3.svg.axis().scale(j).ticks(a).tickFormat(d3.time.format("%H:%M")).tickSubdivide(n).tickSize(4,4,0).orient("bottom"))}function h(t){function a(){var a,n,e,r,i=[],o=[];return t.forEach(function(t){a=d3.max(t.values.map(function(t){return t.empty?0:t.avg})),i.push(a),n=d3.min(t.values.map(function(t){return t.empty?Number.MAX_VALUE:t.avg})),o.push(n)}),e=d3.max(i),r=d3.min(o),[r,e]}var e,r,i=a();return ut=i[1],ct=i[0],ot=Ft?0:ct-.05*ct,xt?(e=1.2*xt,r=ut+.2*(ut-ct),st=e>r?e:r):st=ut+.2*(ut-ct),[ot,st||ot?st:n]}function v(t){var a,n=9,e=5;if(t&&t[0]&&t[0].values){a=t[0].values;var r=h(t);ot=r[0],st=r[1],_=d3.scale.linear().clamp(!0).rangeRound([Yt,0]).domain([ot,st]),K=d3.svg.axis().scale(_).tickSubdivide(1).ticks(5).tickSize(4,4,0).orient("left"),j=d3.time.scale().range([0,Jt]).domain(d3.extent(a,function(t){return t.timestamp})),Q=d3.svg.axis().scale(j).ticks(n).tickFormat(d3.time.format("%H:%M")).tickSubdivide(e).tickSize(4,4,0).orient("bottom")}}function g(a,n,e,i,s){void 0===s&&(s=60);var u={headers:{"Hawkular-Tenant":ht},params:{start:e,end:i,buckets:s}};if(e>=i&&o.log("Start date was after end date"),a&&vt&&n){var c=vt.split("-");r.get(a+"/"+c[0]+"s/"+n+"/"+(c[1]||"data"),u).success(function(a){lt=y(a),t.render(lt,mt)}).error(function(t,a){o.error("Error Loading Chart Data:"+a+", "+t)})}}function y(t){return t?t.map(function(t){var a=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:a,date:new Date(a),value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}function x(t){return t.empty}function b(t){return"undefined"==typeof t.avg}function w(t,a){var n,e,r,i=t.timestamp,o=moment(t.timestamp).format(Ot);return a>0&&(e=X[a-1].timestamp,r=moment(i).from(moment(e),!0)),n=x(t)?"<div class='chartHover'><small class='chartHoverLabel'>"+Mt+"</small>\n                <div><small><span class='chartHoverLabel'>"+Rt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                <hr/>\n                <div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div></div>":b(t)?"<div class='chartHover'><div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Rt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+St+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.value).format("0,0.0")+"</span></small> </div></div> ":"<div class='chartHover'><div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Rt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Et+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.max).format("0,0.0")+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.avg).format("0,0.0")+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Vt+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.min).format("0,0.0")+"</span></small> </div></div> "}function D(t){var a=t.append("defs");a.append("pattern").attr("id","noDataStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").append("path").attr("d","M 0 0 6 0").attr("style","stroke:#CCCCCC; fill:none;"),a.append("pattern").attr("id","unknownStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#2E9EC2; fill:none;").append("path").attr("d","M 0 0 6 0"),a.append("pattern").attr("id","downStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#ff8a9a; fill:none;").append("path").attr("d","M 0 0 6 0")}function k(t,a){it.selectAll("rect.leaderBar").data(X).enter().append("rect").attr("class","leaderBar").attr("x",function(t){return j(t.timestamp)}).attr("y",function(t){return x(t)?0:_(t.min)}).attr("height",function(t){return x(t)?Yt-_(a):Yt-_(t.min)}).attr("width",function(){return Z()}).attr("opacity",".6").attr("fill",function(t){return x(t)?"url(#noDataStripes)":"#d3d3d6"}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()}),it.selectAll("rect.high").data(X).enter().append("rect").attr("class","high").attr("x",function(t){return j(t.timestamp)}).attr("y",function(a){return _(isNaN(a.max)?t:a.max)}).attr("height",function(t){return x(t)?0:_(t.avg)-_(t.max)}).attr("width",function(){return Z()}).attr("data-rhq-value",function(t){return t.max}).attr("opacity",.9).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()}),it.selectAll("rect.low").data(X).enter().append("rect").attr("class","low").attr("x",function(t){return j(t.timestamp)}).attr("y",function(t){return isNaN(t.avg)?Yt:_(t.avg)}).attr("height",function(t){return x(t)?0:_(t.min)-_(t.avg)}).attr("width",function(){return Z()}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.min}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()}),it.selectAll("rect.singleValue").data(X).enter().append("rect").attr("class","singleValue").attr("x",function(t){return j(t.timestamp)}).attr("y",function(t){return isNaN(t.value)?Yt:_(t.value)-2}).attr("height",function(t){return x(t)?0:t.min===t.max?_(t.min)-_(t.value)+2:0}).attr("width",function(){return Z()}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.value}).attr("fill",function(t){return t.min===t.max?"#50505a":"#70c4e2"}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()})}function L(){var t="0.6";it.selectAll("rect.histogram").data(X).enter().append("rect").attr("class","histogram").attr("x",function(t){return j(t.timestamp)}).attr("width",function(){return Z()}).attr("y",function(t){return x(t)?0:_(t.avg)}).attr("height",function(t){return x(t)?Yt-_(st):Yt-_(t.avg)}).attr("fill",function(t,a){return x(t)?"url(#noDataStripes)":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return x(t),"0"}).attr("data-hawkular-value",function(t){return t.avg}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()}),Bt===!1&&(it.selectAll(".histogram.top.stem").data(X).enter().append("line").attr("class","histogramTopStem").attr("x1",function(t){return c(t)}).attr("x2",function(t){return c(t)}).attr("y1",function(t){return _(t.max)}).attr("y2",function(t){return _(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),it.selectAll(".histogram.bottom.stem").data(X).enter().append("line").attr("class","histogramBottomStem").attr("x1",function(t){return c(t)}).attr("x2",function(t){return c(t)}).attr("y1",function(t){return _(t.avg)}).attr("y2",function(t){return _(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),it.selectAll(".histogram.top.cross").data(X).enter().append("line").attr("class","histogramTopCross").attr("x1",function(t){return c(t)-3}).attr("x2",function(t){return c(t)+3}).attr("y1",function(t){return _(t.max)}).attr("y2",function(t){return _(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}),it.selectAll(".histogram.bottom.cross").data(X).enter().append("line").attr("class","histogramBottomCross").attr("x1",function(t){return c(t)-3}).attr("x2",function(t){return c(t)+3}).attr("y1",function(t){return _(t.min)}).attr("y2",function(t){return _(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}))}function A(){var t=d3.svg.line().interpolate(bt).defined(function(t){return!t.empty}).x(function(t){return j(t.timestamp)}).y(function(t){return _(b(t)?t.value:t.avg)});it.append("path").datum(X).attr("class","avgLine").attr("d",t)}function C(){var t=d3.svg.line().interpolate(bt).defined(function(t){return!t.empty}).x(function(t){return j(t.timestamp)}).y(function(t){return _(b(t)?t.value:t.avg)});it.append("path").datum(X).attr("class","metricLine").attr("d",t)}function H(t){var a=d3.scale.category10(),n=0;t?t.forEach(function(t){t&&t.values&&(it.append("path").datum(t.values).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:a(n)}).attr("d",E("linear")),n++)}):o.warn("No multi-data set for multiline chart")}function T(){var t=d3.svg.area().interpolate(bt).defined(function(t){return!t.empty}).x(function(t){return c(t)}).y(function(t){return _(b(t)?t.value:t.max)}).y0(function(t){return _(b(t)?t.value:t.avg)}),a=d3.svg.area().interpolate(bt).defined(function(t){return!t.empty}).x(function(t){return c(t)}).y(function(t){return _(b(t)?t.value:t.avg)}).y0(function(t){return _(b(t)?t.value:t.min)}),n=d3.svg.area().interpolate(bt).defined(function(t){return!t.empty}).x(function(t){return c(t)}).y(function(t){return _(b(t)?t.value:t.min)}).y0(function(){return Yt});Bt===!1&&(it.append("path").datum(X).attr("class","highArea").attr("d",t),it.append("path").datum(X).attr("class","lowArea").attr("d",n)),it.append("path").datum(X).attr("class","avgArea").attr("d",a)}function S(){Bt===!1&&(it.selectAll(".highDot").data(X).enter().append("circle").attr("class","highDot").attr("r",3).attr("cx",function(t){return c(t)}).attr("cy",function(t){return _(b(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()}),it.selectAll(".lowDot").data(X).enter().append("circle").attr("class","lowDot").attr("r",3).attr("cx",function(t){return c(t)}).attr("cy",function(t){return _(b(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()})),it.selectAll(".avgDot").data(X).enter().append("circle").attr("class","avgDot").attr("r",3).attr("cx",function(t){return c(t)}).attr("cy",function(t){return _(b(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()})}function M(){it.selectAll(".scatterline.top.stem").data(X).enter().append("line").attr("class","scatterLineTopStem").attr("x1",function(t){return c(t)}).attr("x2",function(t){return c(t)}).attr("y1",function(t){return _(t.max)}).attr("y2",function(t){return _(t.avg)}).attr("stroke",function(t){return"#000"}),it.selectAll(".scatterline.bottom.stem").data(X).enter().append("line").attr("class","scatterLineBottomStem").attr("x1",function(t){return c(t)}).attr("x2",function(t){return c(t)}).attr("y1",function(t){return _(t.avg)}).attr("y2",function(t){return _(t.min)}).attr("stroke",function(t){return"#000"}),it.selectAll(".scatterline.top.cross").data(X).enter().append("line").attr("class","scatterLineTopCross").attr("x1",function(t){return c(t)-3}).attr("x2",function(t){return c(t)+3}).attr("y1",function(t){return _(t.max)}).attr("y2",function(t){return _(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),it.selectAll(".scatterline.bottom.cross").data(X).enter().append("line").attr("class","scatterLineBottomCross").attr("x1",function(t){return c(t)-3}).attr("x2",function(t){return c(t)+3}).attr("y1",function(t){return _(t.min)}).attr("y2",function(t){return _(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),it.selectAll(".scatterDot").data(X).enter().append("circle").attr("class","avgDot").attr("r",3).attr("cx",function(t){return c(t)}).attr("cy",function(t){return _(b(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()})}function R(){var t;K&&(it.selectAll("g.axis").remove(),t=it.append("g").attr("class","x axis").attr("transform","translate(0,"+Yt+")").call(Q),t.append("g").attr("class","x brush").call(tt).selectAll("rect").attr("y",-6).attr("height",30),it.append("g").attr("class","y axis").call(K).append("text").attr("transform","rotate(-90),translate( -70,-40)").attr("y",-30).style("text-anchor","end").text("NONE"===u.yAxisUnits?"":u.yAxisUnits))}function V(t){var a=t||"monotone",n=d3.svg.line().interpolate(a).defined(function(t){return!t.empty}).x(function(t){return j(t.timestamp)+Z()/2}).y(function(t){return _(b(t)?t.value:t.avg)});return n}function E(t){var a=t||"monotone",n=d3.svg.line().interpolate(a).defined(function(t){return!t.empty}).x(function(t){return j(t.timestamp)}).y(function(t){return _(b(t)?t.value:t.avg)});return n}function $(){("bar"===Tt||"scatterline"===Tt)&&it.append("path").datum(X).attr("class","barAvgLine").attr("d",V("monotone"))}function U(t){var a=d3.svg.line().interpolate("monotone").x(function(t){return j(t.timestamp)}).y(function(a){return _(t)});return a}function I(t){it.append("path").datum(X).attr("class","alertLine").attr("d",U(t))}function N(t,a){function n(t,a){var n,e=[];return t.forEach(function(r,i){0===i&&r.avg>a?e.push(i):(n=t[i-1],r.avg>a&&n&&(!n.avg||n.avg<=a)&&e.push(n.avg?i-1:i))}),e}function r(a,n){var r,i,o,s=[];return a.forEach(function(a){o=t[a];for(var u=a;u<t.length-1;u++)if(r=t[u],i=t[u+1],r.avg>n&&i.avg<=n||r.avg>n&&!i.avg){s.push(new e(o.timestamp,i.avg?i.timestamp:r.timestamp,n));break}}),s.length===a.length-1&&s.push(new e(t[a[a.length-1]].timestamp,t[t.length-1].timestamp,n)),s}var i,o;t[0],t[t.length-1];return o=n(t,a),i=r(o,a)}function B(t){it.selectAll("rect.alert").data(t).enter().append("rect").attr("class","alertBounds").attr("x",function(t){return j(t.startTimestamp)}).attr("y",function(){return _(st)}).attr("height",function(t){return 185}).attr("width",function(t){return j(t.endTimestamp)-j(t.startTimestamp)})}function F(){function a(){it.classed("selecting",!0)}function n(){var a=tt.extent();t.$emit("DateRangeMove",a)}function e(){var a=tt.extent(),n=Math.round(a[0].getTime()),e=Math.round(a[1].getTime()),r=e-n>=6e4;it.classed("selecting",!d3.event.target.empty()),r&&t.$emit("DateRangeChanged",a)}tt=d3.svg.brush().x(at).on("brushstart",a).on("brush",n).on("brushend",e)}function O(t){t&&(o.debug("Running PreviousRangeOverlay"),it.append("path").datum(t).attr("class","prevRangeAvgLine").style("stroke-dasharray","9,3").attr("d",V("linear")))}function z(){var t=d3.scale.category20();Ct&&(o.warn("Running MultiChartOverlay for %i metrics",Ct.length),Ct.forEach(function(a){it.append("path").datum(a).attr("class","multiLine").attr("fill",function(a,n){return t(n)}).attr("stroke",function(a,n){return t(n)}).attr("stroke-width","1").attr("stroke-opacity",".8").attr("d",V("linear"))}))}function J(t){t&&it.selectAll(".annotationDot").data(t).enter().append("circle").attr("class","annotationDot").attr("r",5).attr("cx",function(t){return j(t.timestamp)}).attr("cy",function(){return Yt-_(st)}).style("fill",function(t){return"1"===t.severity?"red":"2"===t.severity?"yellow":"white"})}function P(t){var a=1;it.selectAll(".dataPointDot").data(t).enter().append("circle").attr("class","dataPointDot").attr("r",a).attr("cx",function(t){return j(t.timestamp)}).attr("cy",function(t){return t.avg?_(t.avg):-9999999}).on("mouseover",function(t,a){W.show(t,a)}).on("mouseout",function(){W.hide()})}function Y(){wt=Date.now(),Dt=moment().subtract(gt,"seconds").valueOf(),g(pt,ft,Dt,wt,60)}function q(t){switch(t){case"rhqbar":k(ot,st);break;case"histogram":L();break;case"hawkularline":A();break;case"hawkularmetric":C();break;case"multiline":H(G);break;case"area":T();break;case"scatter":S();break;case"scatterline":M();break;default:o.warn("chart-type is not valid. Must be in [bar,area,line,scatter,candlestick,histogram,hawkularline,hawkularmetric,availability] chart type: "+t)}}var G,X,Z,_,j,K,Q,W,tt,at,nt,et,rt,it,ot,st,ut,ct,lt,mt,dt=[],pt=u.metricUrl,ft=u.metricId||"",ht=u.metricTenantId||"",vt=u.metricType||"gauge",gt=+u.timeRangeInSeconds||43200,yt=+u.refreshIntervalInSeconds||3600,xt=+u.alertValue,bt=u.interpolation||"monotone",wt=Date.now(),Dt=wt-gt,kt=[],Lt=[],At=[],Ct=[],Ht=+u.chartHeight||250,Tt=u.chartType||"hawkularline",St=(u.timeLabel||"Time",u.dateLabel||"Date",u.singleValueLabel||"Raw Value"),Mt=u.noDataLabel||"No Data",Rt=(u.aggregateLabel||"Aggregate",u.startLabel||"Start",u.endLabel||"End",u.durationLabel||"Interval"),Vt=u.minLabel||"Min",Et=u.maxLabel||"Max",$t=u.avgLabel||"Avg",Ut=u.timestampLabel||"Timestamp",It=!0,Nt=!1,Bt=!1,Ft=!1,Ot=(u.chartHoverDateFormat||"%m/%d/%y",u.chartHoverTimeFormat||"%I:%M:%S %p",u.buttonbarDatetimeFormat||"MM/DD/YYYY h:mm a"),zt={top:10,right:5,bottom:5,left:90},Jt=750-zt.left-zt.right,Pt=Ht-50,Yt=Pt-zt.top-zt.bottom,qt=600,Gt=30,Xt=10,Zt=Yt+zt.top-Gt-Xt+zt.bottom,_t=+Gt+Xt+zt.top,jt=2;dt=u.data,Nt=u.showDataPoints,kt=u.previousRangeData,Ct=u.multiChartOverlayData,Lt=u.annotationData,At=u.contextData;var Kt;t.$watch("data",function(a){a&&(lt=angular.fromJson(a),t.render(lt,mt))},!0),t.$watch("multiData",function(a){a&&(G=angular.fromJson(a),t.render(lt,mt))},!0),t.$watch("previousRangeData",function(a){a&&(o.debug("Previous Range data changed"),mt=angular.fromJson(a),t.render(lt,mt))},!0),t.$watch("annotationData",function(a){a&&(Lt=angular.fromJson(a),t.render(lt,mt))},!0),t.$watch("contextData",function(a){a&&(At=angular.fromJson(a),t.render(lt,mt))},!0),t.$on("MultiChartOverlayDataChanged",function(a,n){o.log("Handling MultiChartOverlayDataChanged in Chart Directive"),Ct=n?angular.fromJson(n):[],t.render(lt,mt)}),t.$watchGroup(["alertValue","chartType","hideHighLowValues","useZeroMinValue","showAvgLine"],function(a){xt=a[0]||xt,Tt=a[1]||Tt,Bt=a[2]||Bt,Ft=a[3]||Ft,It=a[4]||It,t.render(lt,mt)}),t.$watchGroup(["metricUrl","metricId","metricType","metricTenantId","timeRangeInSeconds"],function(t){pt=t[0]||pt,ft=t[1]||ft,vt=t[2]||ft,ht=t[3]||ht,gt=t[4]||gt,Y()}),t.$watch("refreshIntervalInSeconds",function(t){t&&(yt=+t,i.cancel(Kt),Kt=i(function(){Y()},1e3*yt))}),t.$on("$destroy",function(){i.cancel(Kt)}),t.$on("DateRangeDragChanged",function(a,n){t.$emit("GraphTimeRangeChangedEvent",n)}),t.render=function(t,n){a&&console.group("Render Chart"),a&&console.time("chartRender"),d(),t&&f(t),G&&v(G),F(),xt&&xt>ot&&st>xt&&B(N(X,xt)),q(Tt),Nt&&P(X),O(n),z(),R(),It&&$(),xt&&xt>ot&&st>xt&&I(xt),Lt&&J(Lt),a&&console.timeEnd("chartRender"),a&&console.groupEnd("Render Chart")}}return{link:s,restrict:"E",replace:!0,scope:{data:"=",multiData:"=",metricUrl:"@",metricId:"@",metricType:"@",metricTenantId:"@",startTimestamp:"@",endTimestamp:"@",timeRangeInSeconds:"@",refreshIntervalInSeconds:"@",previousRangeData:"@",annotationData:"@",contextData:"@",showDataPoints:"@",alertValue:"@",interpolation:"@",multiChartOverlayData:"@",chartHeight:"@",chartType:"@",yAxisUnits:"@",useZeroMinValue:"@",buttonbarDatetimeFormat:"@",timeLabel:"@",dateLabel:"@",chartHoverDateFormat:"@",chartHoverTimeFormat:"@",singleValueLabel:"@",noDataLabel:"@",aggregateLabel:"@",startLabel:"@",endLabel:"@",durationLabel:"@",minLabel:"@",maxLabel:"@",avgLabel:"@",timestampLabel:"@",showAvgLine:"@",hideHighLowValues:"@",chartTitle:"@"}}}])}(Charts||(Charts={}));