angular.module("hawkular.charts",[]);var Charts;!function(t){"use strict";var a=function(){function t(t,a,n,e,r,i,o){this.start=t,this.end=a,this.value=n,this.startDate=e,this.endDate=r,this.duration=i,this.message=o,this.duration=moment(a).from(moment(t),!0),this.startDate=new Date(t),this.endDate=new Date(a)}return t}();t.TransformedAvailDataPoint=a;var n=(angular.module("hawkular.charts").directive("availabilityChart",function(){return new t.AvailabilityChartDirective}),function(){function t(){this.restrict="E",this.replace=!0,this.scope={data:"=",startTimestamp:"@",endTimestamp:"@",chartHeight:"@",timeLabel:"@",dateLabel:"@",noDataLabel:"@",chartTitle:"@"},this.link=function(t,n,e){function r(t){return"<div class='chartHover'><div><small><span class='chartHoverLabel'>Status: </span><span>: </span><span class='chartHoverValue'>"+t.value.toUpperCase()+"</span></small></div>\n          <div><small><span class='chartHoverLabel'>Duration</span><span>: </span><span class='chartHoverValue'>"+t.duration+"</span></small> </div>"}function i(){D&&k.selectAll("*").remove(),k=d3.select(n[0]),D=k.append("svg").attr("viewBox","0 0 760 150").attr("preserveAspectRatio","xMinYMin meet"),b=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return r(t)}),L=D.append("g").attr("width",S+T.left+T.right).attr("height",$).attr("transform","translate("+T.left+","+U+")"),L.append("defs").append("pattern").attr("id","diagonal-stripes").attr("patternUnits","userSpaceOnUse").attr("patternTransform","scale(0.7)").attr("width",4).attr("height",4).append("path").attr("d","M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr("stroke","#B6B6B6").attr("stroke-width",1.2),L.call(b)}function o(t){var a=[];A=+e.startTimestamp||d3.min(t,function(t){return t.start})||+moment().subtract(1,"hour"),t&&(a[0]=A,a[1]=+moment(),h=d3.scale.linear().clamp(!0).rangeRound([70,0]).domain([0,175]),g=d3.svg.axis().scale(h).ticks(0).tickSize(0,0).orient("left"),v=d3.time.scale().range([0,S]).domain(a),y=d3.svg.axis().scale(v).tickSize(-70,0).orient("top").tickFormat(d3.time.format.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]])))}function s(t){return"up"===t.value}function u(t){return"unknown"===t.value}function c(t){var n=[],e=t.length;if(t&&e>0&&t[0].timestamp){var r=(new Date).getTime();if(1===e){var i=t[0];n.push(new a(r-36e5,i.timestamp,"unknown")),n.push(new a(i.timestamp,r,i.value))}else{var o,s;for(o=r,s=t.length;s>0;s--)if(!(t[s-1].timestamp>+moment())){if(A>=t[s-1].timestamp){n.push(new a(A,o,t[s-1].value));break}n.push(new a(t[s-1].timestamp,o,t[s-1].value)),o=t[s-1].timestamp}}}return n}function l(){L.append("text").attr("class","availUpLabel").attr("x",-10).attr("y",25).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Up"),L.append("text").attr("class","availDownLabel").attr("x",-10).attr("y",55).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Down")}function m(t){function a(t){return R-o(0)+(s(t)||u(t)?0:35)}function n(t){return o(0)-(u(t)?15:50)}function e(t){return s(t)?"#54A24E":u(t)?"url(#diagonal-stripes)":"#D85054"}var r=(d3.min(t,function(t){return+t.start}),d3.max(t,function(t){return+t.end})),i=d3.time.scale().range([0,S]).domain([A,r]),o=d3.scale.linear().clamp(!0).range([R,0]).domain([0,4]);d3.svg.axis().scale(i).ticks(8).tickSize(13,0).orient("top");L.selectAll("rect.availBars").data(t).enter().append("rect").attr("class","availBars").attr("x",function(t){return i(+t.start)}).attr("y",function(t){return a(t)}).attr("height",function(t){return n(t)}).attr("width",function(t){return i(+t.end)-i(+t.start)}).attr("fill",function(t){return e(t)}).on("mouseover",function(t,a){b.show(t,a)}).on("mouseout",function(){b.hide()}),L.append("line").attr("x1",0).attr("y1",70).attr("x2",655).attr("y2",70).attr("stroke-width",.5).attr("stroke","#D0D0D0"),l()}function d(){var t;L.selectAll("g.axis").remove(),t=L.append("g").attr("class","x axis").call(y),L.append("g").attr("class","y axis").call(g)}function p(){function a(){L.classed("selecting",!0)}function n(){x.extent()}function e(){var a=x.extent(),n=Math.round(a[0].getTime()),e=Math.round(a[1].getTime()),r=e-n>=6e4;L.classed("selecting",!d3.event.target.empty()),r&&t.$emit("DateRangeChanged",a)}x=d3.svg.brush().x(w).on("brushstart",a).on("brush",n).on("brushend",e)}var f,h,v,g,y,x,b,w,D,k,L,A=+e.startTimestamp,C=+e.endTimestamp,H=+e.chartHeight||150,T=(e.noDataLabel||"No Data",{top:10,right:5,bottom:5,left:90}),S=750-T.left-T.right,M=H-50,R=M-T.top-T.bottom,V=30,E=10,$=R+T.top-V-E,U=+V+E+T.top;t.$watchCollection("data",function(a){console.debug("Avail Chart Data Changed"),a&&(f=c(angular.fromJson(a)),t.render(f))}),t.$watchGroup(["startTimestamp","endTimestamp"],function(a){console.debug("Avail Chart Start/End Timestamp Changed"),A=a[0]||A,C=a[1]||C,t.render(f)}),t.render=function(t){console.debug("Starting Avail Chart Directive Render"),console.group("Render Avail Chart"),t&&(console.time("availChartRender"),i(),o(t),p(),d(),m(t),console.timeEnd("availChartRender")),console.groupEnd()}}}return t}());t.AvailabilityChartDirective=n}(Charts||(Charts={}));var Charts;!function(t){"use strict";var a=!1,n=function(){function t(t,a,n){this.startTimestamp=t,this.endTimestamp=a,this.alertValue=n,this.startDate=new Date(t),this.endDate=new Date(a)}return t}();angular.module("hawkular.charts").directive("hawkularChart",["$rootScope","$http","$interval","$log",function(t,e,r,i){function o(t,o,s){function u(t){return _(t.timestamp)+X()/2}function c(){return 760}function l(){return c()<=Yt}function m(){nt&&et.selectAll("*").remove(),et=d3.select(o[0]),nt=et.append("svg").attr("viewBox","0 0 760 250").attr("preserveAspectRatio","xMinYMin meet"),w(nt),Q=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t,a){return b(t,a)}),rt=nt.append("g").attr("width",zt+Ot.left+Ot.right).attr("height",Xt).attr("transform","translate("+Ot.left+","+Zt+")"),rt.call(Q)}function d(t){function a(){var t,a,n,e,r=[],i=[];return At.forEach(function(n){t=d3.max(n.map(function(t){return t.empty?0:t.avg||t.value})),r.push(t),a=d3.min(n.map(function(t){return t.empty?Number.MAX_VALUE:t.avg||t.value})),i.push(a)}),n=d3.max(r),e=d3.min(i),[e,n]}var n,e;if(At){var r=a();st=r[1],ut=r[0]}t&&(st=d3.max(t.map(function(t){return t.empty?0:t.avg||t.value})),ut=d3.min(t.map(function(t){return t.empty?void 0:t.avg||t.value}))),it=Bt?0:ut-.05*ut,yt?(n=1.2*yt,e=st+.2*(st-ut),ot=n>e?n:e):ot=st+.2*(st-ut)}function p(t){var a,n,e=20;t.length>0&&(l()?(zt=250,a=3,n=2,G=t.slice(t.length-e,t.length)):(a=9,n=5,G=t),d(t),X=function(){return zt/G.length-_t},Z=d3.scale.linear().clamp(!0).rangeRound([Pt,0]).domain([it,ot]),j=d3.svg.axis().scale(Z).tickSubdivide(1).ticks(5).tickSize(4,4,0).orient("left"),_=d3.time.scale().range([0,zt]).domain(d3.extent(G,function(t){return t.timestamp})),Lt?at=d3.time.scale().range([0,zt]).domain(d3.extent(Lt,function(t){return t.timestamp})):tt=d3.time.scale().range([0,zt]).domain(d3.extent(G,function(t){return t.timestamp})),K=d3.svg.axis().scale(_).ticks(a).tickFormat(d3.time.format("%H:%M")).tickSubdivide(n).tickSize(4,4,0).orient("bottom"))}function f(t){function a(){var a,n,e,r,i=[],o=[];return t.forEach(function(t){a=d3.max(t.values.map(function(t){return t.empty?0:t.avg})),i.push(a),n=d3.min(t.values.map(function(t){return t.empty?Number.MAX_VALUE:t.avg})),o.push(n)}),e=d3.max(i),r=d3.min(o),[r,e]}var n,e,r=a();return st=r[1],ut=r[0],it=Bt?0:ut-.05*ut,yt?(n=1.2*yt,e=st+.2*(st-ut),ot=n>e?n:e):ot=st+.2*(st-ut),[it,ot]}function h(t){var a,n=9,e=5;if(t&&t[0]&&t[0].values){a=t[0].values;var r=f(t);it=r[0],ot=r[1],Z=d3.scale.linear().clamp(!0).rangeRound([Pt,0]).domain([it,ot]),j=d3.svg.axis().scale(Z).tickSubdivide(1).ticks(5).tickSize(4,4,0).orient("left"),_=d3.time.scale().range([0,zt]).domain(d3.extent(a,function(t){return t.timestamp})),K=d3.svg.axis().scale(_).ticks(n).tickFormat(d3.time.format("%H:%M")).tickSubdivide(e).tickSize(4,4,0).orient("bottom")}}function v(a,n,r,o,s){void 0===s&&(s=60);var u={headers:{"Hawkular-Tenant":ft},params:{start:r,end:o,buckets:s}};if(r>=o&&i.log("Start date was after end date"),a&&ht&&n){var c=ht.split("-");e.get(a+"/"+c[0]+"s/"+n+"/"+(c[1]||"data"),u).success(function(a){ct=g(a),t.render(ct,lt)}).error(function(t,a){i.error("Error Loading Chart Data:"+a+", "+t)})}}function g(t){return t?t.map(function(t){var a=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:a,date:new Date(a),value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}function y(t){return t.empty}function x(t){return"undefined"==typeof t.avg}function b(t,a){var n,e,r,i=t.timestamp,o=moment(t.timestamp).format(Ft);return a>0&&(e=G[a-1].timestamp,r=moment(i).from(moment(e),!0)),n=y(t)?"<div class='chartHover'><small class='chartHoverLabel'>"+St+"</small>\n                <div><small><span class='chartHoverLabel'>"+Mt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                <hr/>\n                <div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div></div>":x(t)?"<div class='chartHover'><div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Mt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Tt+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.value).format("0,0.0")+"</span></small> </div></div> ":"<div class='chartHover'><div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Mt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Vt+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.max).format("0,0.0")+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Et+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.avg).format("0,0.0")+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Rt+"</span><span>: </span><span class='chartHoverValue'>"+numeral(t.min).format("0,0.0")+"</span></small> </div></div> "}function w(t){var a=t.append("defs");a.append("pattern").attr("id","noDataStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").append("path").attr("d","M 0 0 6 0").attr("style","stroke:#CCCCCC; fill:none;"),a.append("pattern").attr("id","unknownStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#2E9EC2; fill:none;").append("path").attr("d","M 0 0 6 0"),a.append("pattern").attr("id","downStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#ff8a9a; fill:none;").append("path").attr("d","M 0 0 6 0")}function D(t,a){rt.selectAll("rect.leaderBar").data(G).enter().append("rect").attr("class","leaderBar").attr("x",function(t){return _(t.timestamp)}).attr("y",function(t){return y(t)?0:Z(t.min)}).attr("height",function(t){return y(t)?Pt-Z(a):Pt-Z(t.min)}).attr("width",function(){return X()}).attr("opacity",".6").attr("fill",function(t){return y(t)?"url(#noDataStripes)":"#d3d3d6"}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()}),rt.selectAll("rect.high").data(G).enter().append("rect").attr("class","high").attr("x",function(t){return _(t.timestamp)}).attr("y",function(a){return Z(isNaN(a.max)?t:a.max)}).attr("height",function(t){return y(t)?0:Z(t.avg)-Z(t.max)}).attr("width",function(){return X()}).attr("data-rhq-value",function(t){return t.max}).attr("opacity",.9).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()}),rt.selectAll("rect.low").data(G).enter().append("rect").attr("class","low").attr("x",function(t){return _(t.timestamp)}).attr("y",function(t){return isNaN(t.avg)?Pt:Z(t.avg)}).attr("height",function(t){return y(t)?0:Z(t.min)-Z(t.avg)}).attr("width",function(){return X()}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.min}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()}),rt.selectAll("rect.singleValue").data(G).enter().append("rect").attr("class","singleValue").attr("x",function(t){return _(t.timestamp)}).attr("y",function(t){return isNaN(t.value)?Pt:Z(t.value)-2}).attr("height",function(t){return y(t)?0:t.min===t.max?Z(t.min)-Z(t.value)+2:0}).attr("width",function(){return X()}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.value}).attr("fill",function(t){return t.min===t.max?"#50505a":"#70c4e2"}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()})}function k(){var t="0.6";rt.selectAll("rect.histogram").data(G).enter().append("rect").attr("class","histogram").attr("x",function(t){return _(t.timestamp)}).attr("width",function(){return X()}).attr("y",function(t){return y(t)?0:Z(t.avg)}).attr("height",function(t){return y(t)?Pt-Z(ot):Pt-Z(t.avg)}).attr("fill",function(t,a){return y(t)?"url(#noDataStripes)":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return y(t),"0"}).attr("data-hawkular-value",function(t){return t.avg}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()}),Nt===!1&&(rt.selectAll(".histogram.top.stem").data(G).enter().append("line").attr("class","histogramTopStem").attr("x1",function(t){return u(t)}).attr("x2",function(t){return u(t)}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),rt.selectAll(".histogram.bottom.stem").data(G).enter().append("line").attr("class","histogramBottomStem").attr("x1",function(t){return u(t)}).attr("x2",function(t){return u(t)}).attr("y1",function(t){return Z(t.avg)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),rt.selectAll(".histogram.top.cross").data(G).enter().append("line").attr("class","histogramTopCross").attr("x1",function(t){return u(t)-3}).attr("x2",function(t){return u(t)+3}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}),rt.selectAll(".histogram.bottom.cross").data(G).enter().append("line").attr("class","histogramBottomCross").attr("x1",function(t){return u(t)-3}).attr("x2",function(t){return u(t)+3}).attr("y1",function(t){return Z(t.min)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}))}function L(){var t=d3.svg.line().interpolate(xt).defined(function(t){return!t.empty}).x(function(t){return _(t.timestamp)}).y(function(t){return Z(x(t)?t.value:t.avg)});rt.append("path").datum(G).attr("class","avgLine").attr("d",t)}function A(){var t=d3.svg.line().interpolate(xt).defined(function(t){return!t.empty}).x(function(t){return _(t.timestamp)}).y(function(t){return Z(x(t)?t.value:t.avg)});rt.append("path").datum(G).attr("class","metricLine").attr("d",t)}function C(t){var a=d3.scale.category10(),n=0;t?t.forEach(function(t){t&&t.values&&(rt.append("path").datum(t.values).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:a(n)}).attr("d",V("linear")),n++)}):i.warn("No multi-data set for multiline chart")}function H(){var t=d3.svg.area().interpolate(xt).defined(function(t){return!t.empty}).x(function(t){return u(t)}).y(function(t){return Z(x(t)?t.value:t.max)}).y0(function(t){return Z(x(t)?t.value:t.avg)}),a=d3.svg.area().interpolate(xt).defined(function(t){return!t.empty}).x(function(t){return u(t)}).y(function(t){return Z(x(t)?t.value:t.avg)}).y0(function(t){return Z(x(t)?t.value:t.min)}),n=d3.svg.area().interpolate(xt).defined(function(t){return!t.empty}).x(function(t){return u(t)}).y(function(t){return Z(x(t)?t.value:t.min)}).y0(function(){return Pt});Nt===!1&&(rt.append("path").datum(G).attr("class","highArea").attr("d",t),rt.append("path").datum(G).attr("class","lowArea").attr("d",n)),rt.append("path").datum(G).attr("class","avgArea").attr("d",a)}function T(){Nt===!1&&(rt.selectAll(".highDot").data(G).enter().append("circle").attr("class","highDot").attr("r",3).attr("cx",function(t){return u(t)}).attr("cy",function(t){return Z(x(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()}),rt.selectAll(".lowDot").data(G).enter().append("circle").attr("class","lowDot").attr("r",3).attr("cx",function(t){return u(t)}).attr("cy",function(t){return Z(x(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()})),rt.selectAll(".avgDot").data(G).enter().append("circle").attr("class","avgDot").attr("r",3).attr("cx",function(t){return u(t)}).attr("cy",function(t){return Z(x(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()})}function S(){rt.selectAll(".scatterline.top.stem").data(G).enter().append("line").attr("class","scatterLineTopStem").attr("x1",function(t){return u(t)}).attr("x2",function(t){return u(t)}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.avg)}).attr("stroke",function(t){return"#000"}),rt.selectAll(".scatterline.bottom.stem").data(G).enter().append("line").attr("class","scatterLineBottomStem").attr("x1",function(t){return u(t)}).attr("x2",function(t){return u(t)}).attr("y1",function(t){return Z(t.avg)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"#000"}),rt.selectAll(".scatterline.top.cross").data(G).enter().append("line").attr("class","scatterLineTopCross").attr("x1",function(t){return u(t)-3}).attr("x2",function(t){return u(t)+3}).attr("y1",function(t){return Z(t.max)}).attr("y2",function(t){return Z(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),rt.selectAll(".scatterline.bottom.cross").data(G).enter().append("line").attr("class","scatterLineBottomCross").attr("x1",function(t){return u(t)-3}).attr("x2",function(t){return u(t)+3}).attr("y1",function(t){return Z(t.min)}).attr("y2",function(t){return Z(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),rt.selectAll(".scatterDot").data(G).enter().append("circle").attr("class","avgDot").attr("r",3).attr("cx",function(t){return u(t)}).attr("cy",function(t){return Z(x(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()})}function M(){var t;j&&(rt.selectAll("g.axis").remove(),t=rt.append("g").attr("class","x axis").attr("transform","translate(0,"+Pt+")").call(K),t.append("g").attr("class","x brush").call(W).selectAll("rect").attr("y",-6).attr("height",30),rt.append("g").attr("class","y axis").call(j).append("text").attr("transform","rotate(-90),translate( -70,-40)").attr("y",-30).style("text-anchor","end").text("NONE"===s.yAxisUnits?"":s.yAxisUnits))}function R(t){var a=t||"monotone",n=d3.svg.line().interpolate(a).defined(function(t){return!t.empty}).x(function(t){return _(t.timestamp)+X()/2}).y(function(t){return Z(x(t)?t.value:t.avg)});return n}function V(t){var a=t||"monotone",n=d3.svg.line().interpolate(a).defined(function(t){return!t.empty}).x(function(t){return _(t.timestamp)}).y(function(t){return Z(x(t)?t.value:t.avg)});return n}function E(){("bar"===Ht||"scatterline"===Ht)&&rt.append("path").datum(G).attr("class","barAvgLine").attr("d",R("monotone"))}function $(t){var a=d3.svg.line().interpolate("monotone").x(function(t){return _(t.timestamp)}).y(function(a){return Z(t)});return a}function U(t){rt.append("path").datum(G).attr("class","alertLine").attr("d",$(t))}function I(t,a){function e(t,a){var n,e=[];return t.forEach(function(r,i){0===i&&r.avg>a?e.push(i):(n=t[i-1],r.avg>a&&n&&(!n.avg||n.avg<=a)&&e.push(n.avg?i-1:i))}),e}function r(a,e){var r,i,o,s=[];return a.forEach(function(a){o=t[a];for(var u=a;u<t.length-1;u++)if(r=t[u],i=t[u+1],r.avg>e&&i.avg<=e||r.avg>e&&!i.avg){s.push(new n(o.timestamp,i.avg?i.timestamp:r.timestamp,e));break}}),s.length===a.length-1&&s.push(new n(t[a[a.length-1]].timestamp,t[t.length-1].timestamp,e)),s}var i,o;t[0],t[t.length-1];return o=e(t,a),i=r(o,a)}function N(t){rt.selectAll("rect.alert").data(t).enter().append("rect").attr("class","alertBounds").attr("x",function(t){return _(t.startTimestamp)}).attr("y",function(){return Z(ot)}).attr("height",function(t){return 185}).attr("width",function(t){return _(t.endTimestamp)-_(t.startTimestamp)})}function B(){function a(){rt.classed("selecting",!0)}function n(){var a=W.extent();t.$emit("DateRangeMove",a)}function e(){var a=W.extent(),n=Math.round(a[0].getTime()),e=Math.round(a[1].getTime()),r=e-n>=6e4;rt.classed("selecting",!d3.event.target.empty()),r&&t.$emit("DateRangeChanged",a)}W=d3.svg.brush().x(tt).on("brushstart",a).on("brush",n).on("brushend",e)}function F(t){t&&(i.debug("Running PreviousRangeOverlay"),rt.append("path").datum(t).attr("class","prevRangeAvgLine").style("stroke-dasharray","9,3").attr("d",R("linear")))}function O(){var t=d3.scale.category20();At&&(i.warn("Running MultiChartOverlay for %i metrics",At.length),At.forEach(function(a){rt.append("path").datum(a).attr("class","multiLine").attr("fill",function(a,n){return t(n)}).attr("stroke",function(a,n){return t(n)}).attr("stroke-width","1").attr("stroke-opacity",".8").attr("d",R("linear"))}))}function z(t){t&&rt.selectAll(".annotationDot").data(t).enter().append("circle").attr("class","annotationDot").attr("r",5).attr("cx",function(t){return _(t.timestamp)}).attr("cy",function(){return Pt-Z(ot)}).style("fill",function(t){return"1"===t.severity?"red":"2"===t.severity?"yellow":"white"})}function J(t){var a=1;rt.selectAll(".dataPointDot").data(t).enter().append("circle").attr("class","dataPointDot").attr("r",a).attr("cx",function(t){return _(t.timestamp)}).attr("cy",function(t){return t.avg?Z(t.avg):-9999999}).on("mouseover",function(t,a){Q.show(t,a)}).on("mouseout",function(){Q.hide()})}function P(){bt=Date.now(),wt=moment().subtract(vt,"seconds").valueOf(),v(dt,pt,wt,bt,60)}function Y(t){switch(t){case"rhqbar":D(it,ot);break;case"histogram":k();break;case"hawkularline":L();break;case"hawkularmetric":A();break;case"multiline":C(q);break;case"area":H();break;case"scatter":T();break;case"scatterline":S();break;default:i.warn("chart-type is not valid. Must be in [bar,area,line,scatter,candlestick,histogram,hawkularline,hawkularmetric,availability] chart type: "+t)}}var q,G,X,Z,_,j,K,Q,W,tt,at,nt,et,rt,it,ot,st,ut,ct,lt,mt=[],dt=s.metricUrl,pt=s.metricId||"",ft=s.metricTenantId||"",ht=s.metricType||"gauge",vt=+s.timeRangeInSeconds||43200,gt=+s.refreshIntervalInSeconds||3600,yt=+s.alertValue,xt=s.interpolation||"monotone",bt=Date.now(),wt=bt-vt,Dt=[],kt=[],Lt=[],At=[],Ct=+s.chartHeight||250,Ht=s.chartType||"hawkularline",Tt=(s.timeLabel||"Time",s.dateLabel||"Date",s.singleValueLabel||"Raw Value"),St=s.noDataLabel||"No Data",Mt=(s.aggregateLabel||"Aggregate",s.startLabel||"Start",s.endLabel||"End",s.durationLabel||"Interval"),Rt=s.minLabel||"Min",Vt=s.maxLabel||"Max",Et=s.avgLabel||"Avg",$t=s.timestampLabel||"Timestamp",Ut=!0,It=!1,Nt=!1,Bt=!1,Ft=(s.chartHoverDateFormat||"%m/%d/%y",s.chartHoverTimeFormat||"%I:%M:%S %p",s.buttonbarDatetimeFormat||"MM/DD/YYYY h:mm a"),Ot={top:10,right:5,bottom:5,left:90},zt=750-Ot.left-Ot.right,Jt=Ct-50,Pt=Jt-Ot.top-Ot.bottom,Yt=600,qt=30,Gt=10,Xt=Pt+Ot.top-qt-Gt+Ot.bottom,Zt=+qt+Gt+Ot.top,_t=2;mt=s.data,It=s.showDataPoints,Dt=s.previousRangeData,At=s.multiChartOverlayData,kt=s.annotationData,Lt=s.contextData;var jt;t.$watch("data",function(a){a&&(ct=angular.fromJson(a),t.render(ct,lt))},!0),t.$watch("multiData",function(a){a&&(q=angular.fromJson(a),t.render(ct,lt))},!0),t.$watch("previousRangeData",function(a){a&&(i.debug("Previous Range data changed"),lt=angular.fromJson(a),t.render(ct,lt))},!0),t.$watch("annotationData",function(a){a&&(kt=angular.fromJson(a),t.render(ct,lt))},!0),t.$watch("contextData",function(a){a&&(Lt=angular.fromJson(a),t.render(ct,lt))},!0),t.$on("MultiChartOverlayDataChanged",function(a,n){i.log("Handling MultiChartOverlayDataChanged in Chart Directive"),At=n?angular.fromJson(n):[],t.render(ct,lt)}),t.$watchGroup(["alertValue","chartType","hideHighLowValues","useZeroMinValue","showAvgLine"],function(a){yt=a[0]||yt,Ht=a[1]||Ht,Nt=a[2]||Nt,Bt=a[3]||Bt,Ut=a[4]||Ut,t.render(ct,lt)}),t.$watchGroup(["metricUrl","metricId","metricType","metricTenantId","timeRangeInSeconds"],function(t){dt=t[0]||dt,pt=t[1]||pt,ht=t[2]||pt,ft=t[3]||ft,vt=t[4]||vt,P()}),t.$watch("refreshIntervalInSeconds",function(t){t&&(gt=+t,r.cancel(jt),jt=r(function(){P()},1e3*gt))}),t.$on("$destroy",function(){r.cancel(jt)}),t.$on("DateRangeDragChanged",function(a,n){t.$emit("GraphTimeRangeChangedEvent",n)}),t.render=function(t,n){a&&console.group("Render Chart"),a&&console.time("chartRender"),m(),t&&p(t),q&&h(q),B(),yt&&yt>it&&ot>yt&&N(I(G,yt)),Y(Ht),It&&J(G),F(n),O(),M(),Ut&&E(),yt&&yt>it&&ot>yt&&U(yt),kt&&z(kt),a&&console.timeEnd("chartRender"),a&&console.groupEnd("Render Chart")}}return{link:o,restrict:"E",replace:!0,scope:{data:"=",multiData:"=",metricUrl:"@",metricId:"@",metricType:"@",metricTenantId:"@",startTimestamp:"@",endTimestamp:"@",timeRangeInSeconds:"@",refreshIntervalInSeconds:"@",previousRangeData:"@",annotationData:"@",contextData:"@",showDataPoints:"@",alertValue:"@",interpolation:"@",multiChartOverlayData:"@",chartHeight:"@",chartType:"@",yAxisUnits:"@",useZeroMinValue:"@",buttonbarDatetimeFormat:"@",timeLabel:"@",dateLabel:"@",chartHoverDateFormat:"@",chartHoverTimeFormat:"@",singleValueLabel:"@",noDataLabel:"@",aggregateLabel:"@",startLabel:"@",endLabel:"@",durationLabel:"@",minLabel:"@",maxLabel:"@",avgLabel:"@",timestampLabel:"@",showAvgLine:"@",hideHighLowValues:"@",chartTitle:"@"}}}])}(Charts||(Charts={}));