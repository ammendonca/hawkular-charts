angular.module("hawkular.charts",[]);var Charts;!function(t){"use strict";var a=angular.module("hawkular.charts"),n=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.UP="up",t.DOWN="down",t.UNKNOWN="unknown",t}();t.AvailStatus=n;var e=function(){function t(t,a,n,e,r,i,o){this.start=t,this.end=a,this.value=n,this.startDate=e,this.endDate=r,this.duration=i,this.message=o,this.duration=moment(a).from(moment(t),!0),this.startDate=new Date(t),this.endDate=new Date(a)}return t}();t.TransformedAvailDataPoint=e;var r=function(){function a(a){var r=this;this.restrict="E",this.replace=!0,this.scope={data:"=",startTimestamp:"@",endTimestamp:"@",chartHeight:"@",timeLabel:"@",dateLabel:"@",noDataLabel:"@",chartTitle:"@"},this.link=function(i,o,s){function u(t){return"<div class='chartHover'>\n        <div>\n        <small>\n          <span class='chartHoverLabel'>Status: </span><span>: </span>\n          <span class='chartHoverValue'>"+t.value.toUpperCase()+"</span>\n        </small>\n        </div>\n          <div>\n          <small>\n            <span class='chartHoverLabel'>Duration</span><span>: </span>\n            <span class='chartHoverValue'>"+t.duration+"</span>\n          </small>\n          </div>\n        </div>"}function c(){L&&H.selectAll("*").remove(),H=d3.select(o[0]),L=H.append("svg").attr("viewBox","0 0 760 150").attr("preserveAspectRatio","xMinYMin meet"),C=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return u(t)}),T=L.append("g").attr("width",N+M.left+M.right).attr("height",$).attr("transform","translate("+M.left+","+F+")"),T.append("defs").append("pattern").attr("id","diagonal-stripes").attr("patternUnits","userSpaceOnUse").attr("patternTransform","scale(0.7)").attr("width",4).attr("height",4).append("path").attr("d","M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr("stroke","#B6B6B6").attr("stroke-width",1.2),T.call(C)}function l(t){var a=[];S=+s.startTimestamp||d3.min(t,function(t){return t.start})||+moment().subtract(1,"hour"),t&&t.length>0&&(a[0]=S,a[1]=+moment(),y=d3.scale.linear().clamp(!0).rangeRound([70,0]).domain([0,175]),w=d3.svg.axis().scale(y).ticks(0).tickSize(0,0).orient("left"),x=d3.time.scale().range([0,N]).domain(a),k=d3.svg.axis().scale(x).tickSize(-70,0).orient("top").tickFormat(d3.time.format.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]])))}function m(t){return t.value===n.UP.toString()}function d(t){return t.value===n.UNKNOWN.toString()}function f(t){function a(t,a){return t.timestamp<a.timestamp?-1:t.timestamp>a.timestamp?1:0}var r=[],i=t.length;if(t.sort(a),t&&i>0&&t[0].timestamp){var o=(new Date).getTime();if(1===i){var s=t[0];r.push(new e(o-36e5,s.timestamp,n.UNKNOWN.toString())),r.push(new e(s.timestamp,o,s.value))}else for(var u=o,c=t.length;c>0;c--){if(S>=t[c-1].timestamp){r.push(new e(S,u,t[c-1].value));break}r.push(new e(t[c-1].timestamp,u,t[c-1].value)),u=t[c-1].timestamp}}return r}function p(){T.append("text").attr("class","availUpLabel").attr("x",-10).attr("y",25).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Up"),T.append("text").attr("class","availDownLabel").attr("x",-10).attr("y",55).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Down")}function h(t){function a(t){return I-o(0)+(m(t)||d(t)?0:35)}function n(t){return o(0)-(d(t)?15:50)}function e(t){return m(t)?"#54A24E":d(t)?"url(#diagonal-stripes)":"#D85054"}var r=(d3.min(t,function(t){return+t.start}),d3.max(t,function(t){return+t.end})),i=d3.time.scale().range([0,N]).domain([S,r]),o=d3.scale.linear().clamp(!0).range([I,0]).domain([0,4]);d3.svg.axis().scale(i).ticks(8).tickSize(13,0).orient("top");T.selectAll("rect.availBars").data(t).enter().append("rect").attr("class","availBars").attr("x",function(t){return i(+t.start)}).attr("y",function(t){return a(t)}).attr("height",function(t){return n(t)}).attr("width",function(t){return i(+t.end)-i(+t.start)}).attr("fill",function(t){return e(t)}).attr("opacity",function(){return.85}).on("mouseover",function(t,a){C.show(t,a)}).on("mouseout",function(){C.hide()}),T.append("line").attr("x1",0).attr("y1",70).attr("x2",655).attr("y2",70).attr("stroke-width",.5).attr("stroke","#D0D0D0"),p()}function v(){T.selectAll("g.axis").remove(),A=T.append("g").attr("class","x axis").call(k),T.append("g").attr("class","y axis").call(w)}function g(){function n(){T.classed("selecting",!0)}function e(){var n=b.extent(),e=Math.round(n[0].getTime()),r=Math.round(n[1].getTime()),i=r-e;i>=6e4&&(console.log("Drag: AvailTimeRangeChanged:"+n),a.$broadcast(t.EventNames.AVAIL_CHART_TIMERANGE_CHANGED.toString(),n)),D.call(b.clear())}b=d3.svg.brush().x(x).on("brushstart",n).on("brushend",e),A.append("g").attr("class","x brush").call(b).selectAll("rect").attr("y",0).attr("height",70),D=T.append("g").attr("class","brush").call(b),D.selectAll(".resize").append("path"),D.selectAll("rect").attr("height",70)}var y,x,w,k,A,b,D,C,L,H,T,S=+s.startTimestamp,E=+s.endTimestamp,R=+s.chartHeight||150,M=(s.noDataLabel||"No Data",{top:10,right:5,bottom:5,left:90}),N=750-M.left-M.right,V=R-50,I=V-M.top-M.bottom,U=30,B=10,$=I+M.top-U-B,F=+U+B+M.top;i.$watchCollection("data",function(t){console.log("Avail Chart Data Changed"),t&&(r.transformedDataPoints=f(angular.fromJson(t)),i.render(r.transformedDataPoints))}),i.$watchGroup(["startTimestamp","endTimestamp"],function(t){console.log("Avail Chart Start/End Timestamp Changed"),S=t[0]||S,E=t[1]||E,i.render(r.transformedDataPoints)}),i.render=function(t){console.log("Starting Avail Chart Directive Render"),t&&t.length>0&&(console.group("Render Avail Chart"),console.time("availChartRender"),c(),l(t),v(),h(t),g(),console.timeEnd("availChartRender"),console.groupEnd())}}}return a.Factory=function(){var t=function(t){return new a(t)};return t.$inject=["$rootScope"],t},a}();t.AvailabilityChartDirective=r,a.directive("availabilityChart",r.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var a=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.CHART_TIMERANGE_CHANGED=new t("ChartTimeRangeChanged"),t.AVAIL_CHART_TIMERANGE_CHANGED=new t("AvailChartTimeRangeChanged"),t.REFRESH_CHART=new t("RefreshChart"),t.REFRESH_AVAIL_CHART=new t("RefreshAvailabilityChart"),t}();t.EventNames=a}(Charts||(Charts={}));var Charts;!function(t){"use strict";var a=!1,n=10,e=function(){function t(t,a,n){this.startTimestamp=t,this.endTimestamp=a,this.alertValue=n,this.startDate=new Date(t),this.endDate=new Date(a)}return t}();angular.module("hawkular.charts").directive("hawkularChart",["$rootScope","$http","$interval","$log",function(r,i,o,s){function u(u,c,l){function m(t){return tt(t.timestamp)+j()/2}function d(){return 760}function f(){return d()<=Xt}function p(){ut&&ct.selectAll("*").remove(),ct=d3.select(c[0]),ut=ct.append("svg").attr("viewBox","0 0 760 "+(Mt+25)).attr("preserveAspectRatio","xMinYMin meet"),D(ut),lt=ut.append("g").attr("width",qt+Yt.left+Yt.right).attr("height",Qt).attr("transform","translate("+Yt.left+","+ta+")"),et=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t,a){return b(t,a)}),lt.call(et),lt.append("g").attr("class","alertHolder"),na=!0}function h(t){function a(){var t,a,n,e,r=[],i=[];return Rt.forEach(function(n){t=d3.max(n.map(function(t){return t.empty?0:t.avg||t.value})),r.push(t),a=d3.min(n.map(function(t){return t.empty?Number.MAX_VALUE:t.avg||t.value})),i.push(a)}),n=d3.max(r),e=d3.min(i),[e,n]}var e,r;if(Rt){var i=a();ft=i[1],pt=i[0]}t&&(ft=d3.max(t.map(function(t){return t.empty?0:t.avg||t.value})),pt=d3.min(t.map(function(t){return t.empty?void 0:t.avg||t.value}))),mt=Pt?0:pt-.05*pt,Dt?(e=1.2*Dt,r=ft+.2*(ft-pt),dt=e>r?e:r):dt=ft+.2*(ft-pt),dt=dt||mt?dt:n}function v(t){var a,n,e=20;t.length>0&&(f()?(qt=250,a=3,n=2,Z=t.slice(t.length-e,t.length)):(a=9,n=5,Z=t),h(t),j=function(){return qt/Z.length-aa},Q=d3.scale.linear().clamp(!0).rangeRound([Kt,0]).domain([mt,dt]),at=d3.svg.axis().scale(Q).ticks(5).tickSize(4,4,0).orient("left"),tt=d3.time.scale().range([0,qt]).domain(d3.extent(Z,function(t){return t.timestamp})),Et?st=d3.time.scale().range([0,qt]).domain(d3.extent(Et,function(t){return t.timestamp})):ot=d3.time.scale().range([0,qt]).domain(d3.extent(Z,function(t){return t.timestamp})),nt=d3.svg.axis().scale(tt).ticks(a).tickFormat(d3.time.format("%H:%M")).tickSize(4,4,0).orient("bottom"))}function g(t){function a(){var a,n,e,r,i=[],o=[];return t.forEach(function(t){a=d3.max(t.values.map(function(t){return t.empty?0:t.avg})),i.push(a),n=d3.min(t.values.map(function(t){return t.empty?Number.MAX_VALUE:t.avg})),o.push(n)}),e=d3.max(i),r=d3.min(o),[r,e]}var e,r,i=a();return ft=i[1],pt=i[0],mt=Pt?0:pt-.05*pt,Dt?(e=1.2*Dt,r=ft+.2*(ft-pt),dt=e>r?e:r):dt=ft+.2*(ft-pt),[mt,dt||mt?dt:n]}function y(t){var a,n=9;if(t&&t[0]&&t[0].values){a=t[0].values;var e=g(t);mt=e[0],dt=e[1],Q=d3.scale.linear().clamp(!0).rangeRound([Kt,0]).domain([mt,dt]),at=d3.svg.axis().scale(Q).ticks(5).tickSize(4,4,0).orient("left"),tt=d3.time.scale().range([0,qt]).domain(d3.extent(a,function(t){return t.timestamp})),nt=d3.svg.axis().scale(tt).ticks(n).tickFormat(d3.time.format("%H:%M")).tickSize(4,4,0).orient("bottom")}}function x(t,a,n,e,r){void 0===r&&(r=60);var o={headers:{"Hawkular-Tenant":wt},params:{start:n,end:e,buckets:r}};if(n>=e&&s.log("Start date was after end date"),t&&kt&&a){var c=kt.split("-");i.get(t+"/"+c[0]+"s/"+a+"/"+(c[1]||"data"),o).success(function(t){ht=w(t),u.render(ht,vt)}).error(function(t,a){s.error("Error Loading Chart Data:"+a+", "+t)})}}function w(t){return t?t.map(function(t){var a=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:a,date:new Date(a),value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}function k(t){return t.empty}function A(t){return"undefined"==typeof t.avg}function b(t,a){var n,e,r,i=t.timestamp,o=moment(t.timestamp).format(Jt);return a>0&&(e=Z[a-1].timestamp,r=moment(i).from(moment(e),!0)),n=k(t)?"<div class='chartHover'>\n                <small class='chartHoverLabel'>"+It+"</small>\n                <div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                <hr/>\n                <div><small><span class='chartHoverLabel'>"+_t+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                </div>":A(t)?"<div class='chartHover'>\n                <div><small><span class='chartHoverLabel'>"+_t+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small></div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Vt+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.value,2)+"</span></small> </div>\n                  </div> ":"<div class='chartHover'>\n                <small>\n                  <span class='chartHoverLabel'>"+_t+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span>\n                </small>\n                  <div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.max,2)+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Ft+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.avg,2)+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Bt+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.min,2)+"</span></small> </div>\n                  </div> "}function D(t){var a=t.append("defs");a.append("pattern").attr("id","noDataStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").append("path").attr("d","M 0 0 6 0").attr("style","stroke:#CCCCCC; fill:none;"),a.append("pattern").attr("id","unknownStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#2E9EC2; fill:none;").append("path").attr("d","M 0 0 6 0"),a.append("pattern").attr("id","downStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#ff8a9a; fill:none;").append("path").attr("d","M 0 0 6 0")}function C(t,a){lt.selectAll("rect.leaderBar").data(Z).enter().append("rect").attr("class","leaderBar").attr("x",function(t){return tt(t.timestamp)}).attr("y",function(t){return k(t)?0:Q(t.min)}).attr("height",function(t){return k(t)?Kt-Q(a):Kt-Q(t.min)}).attr("width",function(){return j()}).attr("opacity",".6").attr("fill",function(t){return k(t)?"url(#noDataStripes)":"#d3d3d6"}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}),lt.selectAll("rect.high").data(Z).enter().append("rect").attr("class","high").attr("x",function(t){return tt(t.timestamp)}).attr("y",function(a){return Q(isNaN(a.max)?t:a.max)}).attr("height",function(t){return k(t)?0:Q(t.avg)-Q(t.max)}).attr("width",function(){return j()}).attr("data-rhq-value",function(t){return t.max}).attr("opacity",.9).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}),lt.selectAll("rect.low").data(Z).enter().append("rect").attr("class","low").attr("x",function(t){return tt(t.timestamp)}).attr("y",function(t){return isNaN(t.avg)?Kt:Q(t.avg)}).attr("height",function(t){return k(t)?0:Q(t.min)-Q(t.avg)}).attr("width",function(){return j()}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.min}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}),lt.selectAll("rect.singleValue").data(Z).enter().append("rect").attr("class","singleValue").attr("x",function(t){return tt(t.timestamp)}).attr("y",function(t){return isNaN(t.value)?Kt:Q(t.value)-2}).attr("height",function(t){return k(t)?0:t.min===t.max?Q(t.min)-Q(t.value)+2:0}).attr("width",function(){return j()}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.value}).attr("fill",function(t){return t.min===t.max?"#50505a":"#70c4e2"}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()})}function L(){var t="0.6",a=lt.selectAll("rect.histogram").data(Z);if(a.attr("class","histogram").on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}).transition().attr("x",function(t){return tt(t.timestamp)}).attr("width",function(){return j()}).attr("y",function(t){return k(t)?0:Q(t.avg)}).attr("height",function(t){return k(t)?Kt-Q(dt):Kt-Q(t.avg)}).attr("fill",function(t,a){return k(t)?"url(#noDataStripes)":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return k(t),"0"}).attr("data-hawkular-value",function(t){return t.avg}),a.enter().append("rect").on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}).attr("class","histogram").transition().attr("x",function(t){return tt(t.timestamp)}).attr("width",function(){return j()}).attr("y",function(t){return k(t)?0:Q(t.avg)}).attr("height",function(t){return k(t)?Kt-Q(dt):Kt-Q(t.avg)}).attr("fill",function(t,a){return k(t)?"url(#noDataStripes)":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return k(t),"0"}).attr("data-hawkular-value",function(t){return t.avg}),a.exit().remove(),Gt)lt.selectAll(".histogramTopStem, .histogramBottomStem, .histogramTopCross, .histogramBottomCross").remove();else{var n=lt.selectAll(".histogramTopStem").data(Z);n.attr("class","histogramTopStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Q(t.max)}).attr("y2",function(t){return Q(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),n.enter().append("line").attr("class","histogramTopStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Q(t.max)}).attr("y2",function(t){return Q(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),n.exit().remove();var e=lt.selectAll(".histogramBottomStem").data(Z);e.attr("class","histogramBottomStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Q(t.avg)}).attr("y2",function(t){return Q(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),e.enter().append("line").attr("class","histogramBottomStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Q(t.avg)}).attr("y2",function(t){return Q(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(a){return t}),e.exit().remove();var r=lt.selectAll(".histogramTopCross").data(Z);r.attr("class","histogramTopCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Q(t.max)}).attr("y2",function(t){return Q(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}),r.enter().append("line").attr("class","histogramTopCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Q(t.max)}).attr("y2",function(t){return Q(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}),r.exit().remove();var i=lt.selectAll(".histogramBottomCross").data(Z);i.attr("class","histogramBottomCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Q(t.min)}).attr("y2",function(t){return Q(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}),i.enter().append("line").attr("class","histogramBottomCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Q(t.min)}).attr("y2",function(t){return Q(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(a){return t}),i.exit().remove()}}function H(){var t=d3.svg.line().interpolate(Ct).defined(function(t){return!t.empty}).x(function(t){return tt(t.timestamp)}).y(function(t){return Q(A(t)?t.value:t.avg)});lt.append("path").datum(Z).attr("class","avgLine").attr("d",t)}function T(){var t=d3.svg.line().interpolate(Ct).defined(function(t){return!t.empty}).x(function(t){return tt(t.timestamp)}).y(function(t){return Q(A(t)?t.value:t.avg)}),a=lt.selectAll("path.metricLine").data([Z]);a.attr("class","metricLine").transition().attr("d",t),a.enter().append("path").attr("class","metricLine").transition().attr("d",t),a.exit().remove()}function S(t){var a=d3.scale.category10(),n=0;t?(lt.selectAll("path[id^='multiLine']")[0].forEach(function(a){var n=!1;t.forEach(function(t){t.keyHash=t.keyHash||"multiLine"+K(t.key),a.getAttribute("id")===t.keyHash&&(n=!0)}),n||a.remove()}),t.forEach(function(t,e){if(t&&t.values){t.keyHash=t.keyHash||"multiLine"+K(t.key);var r=lt.selectAll("path#"+t.keyHash).data([t.values]);r.attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:a(n++)}).transition().attr("d",U("linear")),r.enter().append("path").attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:a(n++)}).transition().attr("d",U("linear")),r.exit().remove()}})):s.warn("No multi-data set for multiline chart")}function E(){var t=d3.svg.area().interpolate(Ct).defined(function(t){return!t.empty}).x(function(t){return m(t)}).y(function(t){return Q(A(t)?t.value:t.max)}).y0(function(t){return Q(A(t)?t.value:t.avg)}),a=d3.svg.area().interpolate(Ct).defined(function(t){return!t.empty}).x(function(t){return m(t)}).y(function(t){return Q(A(t)?t.value:t.avg)}).y0(function(t){return Gt?Kt:Q(t.min)}),n=d3.svg.area().interpolate(Ct).defined(function(t){return!t.empty}).x(function(t){return m(t)}).y(function(t){return Q(A(t)?t.value:t.min)}).y0(function(){return Kt});if(!Gt){var e=lt.selectAll("path.highArea").data([Z]);e.attr("class","highArea").attr("d",t),e.enter().append("path").attr("class","highArea").attr("d",t),e.exit().remove();var r=lt.selectAll("path.lowArea").data([Z]);r.attr("class","lowArea").attr("d",n),r.enter().append("path").attr("class","lowArea").attr("d",n),r.exit().remove()}var i=lt.selectAll("path.avgArea").data([Z]);i.attr("class","avgArea").transition().attr("d",a),i.enter().append("path").attr("class","avgArea").transition().attr("d",a),i.exit().remove()}function R(){Gt===!1&&(lt.selectAll(".highDot").data(Z).enter().append("circle").attr("class","highDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(t){return Q(A(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}),lt.selectAll(".lowDot").data(Z).enter().append("circle").attr("class","lowDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(t){return Q(A(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()})),lt.selectAll(".avgDot").data(Z).enter().append("circle").attr("class","avgDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(t){return Q(A(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()})}function M(){lt.selectAll(".scatterline.top.stem").data(Z).enter().append("line").attr("class","scatterLineTopStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Q(t.max)}).attr("y2",function(t){return Q(t.avg)}).attr("stroke",function(t){return"#000"}),lt.selectAll(".scatterline.bottom.stem").data(Z).enter().append("line").attr("class","scatterLineBottomStem").attr("x1",function(t){return m(t)}).attr("x2",function(t){return m(t)}).attr("y1",function(t){return Q(t.avg)}).attr("y2",function(t){return Q(t.min)}).attr("stroke",function(t){return"#000"}),lt.selectAll(".scatterline.top.cross").data(Z).enter().append("line").attr("class","scatterLineTopCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Q(t.max)}).attr("y2",function(t){return Q(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),lt.selectAll(".scatterline.bottom.cross").data(Z).enter().append("line").attr("class","scatterLineBottomCross").attr("x1",function(t){return m(t)-3}).attr("x2",function(t){return m(t)+3}).attr("y1",function(t){return Q(t.min)}).attr("y2",function(t){return Q(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),lt.selectAll(".scatterDot").data(Z).enter().append("circle").attr("class","avgDot").attr("r",3).attr("cx",function(t){return m(t)}).attr("cy",function(t){return Q(A(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()})}function N(){if(Q){var t=lt.selectAll("g.grid.y_grid");t[0].length||(t=lt.append("g").classed("grid y_grid",!0)),t.call(d3.svg.axis().scale(Q).orient("left").ticks(10).tickSize(-qt,0).tickFormat(""))}}function V(){var t;at&&(lt.selectAll("g.axis").remove(),t=lt.append("g").attr("class","x axis").attr("transform","translate(0,"+Kt+")").call(nt),t.append("g").attr("class","x brush").call(rt).selectAll("rect").attr("y",-6).attr("height",30),lt.append("g").attr("class","y axis").call(at).append("text").attr("transform","rotate(-90),translate(0,-50)").attr("x",-Mt/2).style("text-anchor","start").text("NONE"===l.yAxisUnits?"":l.yAxisUnits))}function I(t){var a=t||"monotone",n=d3.svg.line().interpolate(a).defined(function(t){return!t.empty}).x(function(t){return tt(t.timestamp)+j()/2}).y(function(t){return Q(A(t)?t.value:t.avg)});return n}function U(t){var a=t||"monotone",n=d3.svg.line().interpolate(a).defined(function(t){return!t.empty}).x(function(t){return tt(t.timestamp)}).y(function(t){return Q(A(t)?t.value:t.avg)});return n}function B(){("bar"===Nt||"scatterline"===Nt)&&lt.append("path").datum(Z).attr("class","barAvgLine").attr("d",I("monotone"))}function $(t){var a=d3.svg.line().interpolate("monotone").x(function(t){return tt(t.timestamp)}).y(function(a){return Q(t)});return a}function F(t){var a=lt.selectAll("path.alertLine").data([Z]);a.attr("class","alertLine").attr("d",$(t)),a.enter().append("path").attr("class","alertLine").attr("d",$(t)),a.exit().remove()}function _(t,a){function n(t,a){var n,e=[];return t.forEach(function(r,i){0===i&&r.avg>a?e.push(i):(n=t[i-1],r.avg>a&&n&&(!n.avg||n.avg<=a)&&e.push(n.avg?i-1:i))}),e}function r(a,n){var r,i,o,s=[];return a.forEach(function(a){o=t[a];for(var u=a;u<t.length-1;u++)if(r=t[u],i=t[u+1],r.avg>n&&i.avg<=n||r.avg>n&&!i.avg){s.push(new e(o.timestamp,i.avg?i.timestamp:r.timestamp,n));break}}),s.length===a.length-1&&s.push(new e(t[a[a.length-1]].timestamp,t[t.length-1].timestamp,n)),s}var i,o;t[0],t[t.length-1];return o=n(t,a),i=r(o,a)}function O(t){var a=lt.select("g.alertHolder").selectAll("rect.alertBounds").data(t);a.attr("class","alertBounds").attr("x",function(t){return tt(t.startTimestamp)}).attr("y",function(){return Q(dt)}).attr("height",function(t){return 185}).attr("width",function(t){return tt(t.endTimestamp)-tt(t.startTimestamp)}),a.enter().append("rect").attr("class","alertBounds").attr("x",function(t){return tt(t.startTimestamp)}).attr("y",function(){return Q(dt)}).attr("height",function(t){return 185}).attr("width",function(t){return tt(t.endTimestamp)-tt(t.startTimestamp)}),a.exit().remove()}function z(){function a(){lt.classed("selecting",!0)}function n(){var a=rt.extent(),n=Math.round(a[0].getTime()),e=Math.round(a[1].getTime()),i=e-n;lt.classed("selecting",!d3.event.target.empty()),i>=6e4&&(it.remove(),r.$broadcast(t.EventNames.CHART_TIMERANGE_CHANGED.toString(),a)),it.call(rt.clear())}rt=d3.svg.brush().x(tt).on("brushstart",a).on("brushend",n),it=lt.append("g").attr("class","brush").call(rt),it.selectAll(".resize").append("path"),it.selectAll("rect").attr("height",Kt)}function G(t){t&&lt.append("path").datum(t).attr("class","prevRangeAvgLine").style("stroke-dasharray","9,3").attr("d",I("linear"))}function P(){var t=d3.scale.category20();Rt&&(s.log("Running MultiChartOverlay for %i metrics",Rt.length),Rt.forEach(function(a){lt.append("path").datum(a).attr("class","multiLine").attr("fill",function(a,n){return t(n)}).attr("stroke",function(a,n){return t(n)}).attr("stroke-width","1").attr("stroke-opacity",".8").attr("d",I("linear"))}))}function J(t){t&&lt.selectAll(".annotationDot").data(t).enter().append("circle").attr("class","annotationDot").attr("r",5).attr("cx",function(t){return tt(t.timestamp)}).attr("cy",function(){return Kt-Q(dt)}).style("fill",function(t){return"1"===t.severity?"red":"2"===t.severity?"yellow":"white"})}function Y(t){var a=1,n=lt.selectAll(".dataPointDot").data(t);n.attr("class","dataPointDot").attr("r",a).attr("cx",function(t){return tt(t.timestamp)}).attr("cy",function(t){return t.avg?Q(t.avg):-9999999}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}),n.enter().append("circle").attr("class","dataPointDot").attr("r",a).attr("cx",function(t){return tt(t.timestamp)}).attr("cy",function(t){return t.avg?Q(t.avg):-9999999}).on("mouseover",function(t,a){et.show(t,a)}).on("mouseout",function(){et.hide()}),n.exit().remove()}function q(){Lt=Date.now(),Ht=moment().subtract(At,"seconds").valueOf(),x(yt,xt,Ht,Lt,60)}function W(t){switch(t){case"rhqbar":C(mt,dt);break;case"histogram":L();break;case"hawkularline":H();break;case"hawkularmetric":T();break;case"multiline":S(X);break;case"area":E();break;case"scatter":R();break;case"scatterline":M();break;default:s.warn("chart-type is not valid. Must be in [rhqbar,histogram,area,line,scatter,histogram,hawkularline,hawkularmetric] chart type: "+t)}}function K(t){var a,n,e,r=0;if(0==t.length)return r;for(a=0,e=t.length;e>a;a++)n=t.charCodeAt(a),r=(r<<5)-r+n,r|=0;return r}var X,Z,j,Q,tt,at,nt,et,rt,it,ot,st,ut,ct,lt,mt,dt,ft,pt,ht,vt,gt=[],yt=l.metricUrl,xt=l.metricId||"",wt=l.metricTenantId||"",kt=l.metricType||"gauge",At=+l.timeRangeInSeconds||43200,bt=+l.refreshIntervalInSeconds||3600,Dt=+l.alertValue,Ct=l.interpolation||"monotone",Lt=Date.now(),Ht=Lt-At,Tt=[],St=[],Et=[],Rt=[],Mt=+l.chartHeight||250,Nt=l.chartType||"hawkularline",Vt=(l.timeLabel||"Time",l.dateLabel||"Date",l.singleValueLabel||"Raw Value"),It=l.noDataLabel||"No Data",Ut=(l.aggregateLabel||"Aggregate",l.startLabel||"Start",l.endLabel||"End",l.durationLabel||"Interval"),Bt=l.minLabel||"Min",$t=l.maxLabel||"Max",Ft=l.avgLabel||"Avg",_t=l.timestampLabel||"Timestamp",Ot=!0,zt=!1,Gt=!1,Pt=!1,Jt=(l.chartHoverDateFormat||"%m/%d/%y",l.chartHoverTimeFormat||"%I:%M:%S %p",l.buttonbarDatetimeFormat||"MM/DD/YYYY h:mm a"),Yt={top:10,right:5,bottom:5,left:90},qt=750-Yt.left-Yt.right,Wt=Mt-50,Kt=Wt-Yt.top-Yt.bottom,Xt=600,Zt=30,jt=10,Qt=Kt+Yt.top-Zt-jt+Yt.bottom,ta=+Zt+jt+Yt.top,aa=2,na=!1;gt=l.data,zt=l.showDataPoints,Tt=l.previousRangeData,Rt=l.multiChartOverlayData,St=l.annotationData,Et=l.contextData;var ea;u.$watchCollection("data",function(t){t&&(ht=angular.fromJson(t),u.render(ht,vt))}),u.$watch("multiData",function(t){t&&(X=angular.fromJson(t),u.render(ht,vt))},!0),u.$watch("previousRangeData",function(t){t&&(vt=angular.fromJson(t),u.render(ht,vt))},!0),u.$watch("annotationData",function(t){t&&(St=angular.fromJson(t),u.render(ht,vt))},!0),u.$watch("contextData",function(t){t&&(Et=angular.fromJson(t),u.render(ht,vt))},!0),u.$on("MultiChartOverlayDataChanged",function(t,a){s.log("Handling MultiChartOverlayDataChanged in Chart Directive"),Rt=a?angular.fromJson(a):[],u.render(ht,vt)}),u.$watchGroup(["alertValue","chartType","hideHighLowValues","useZeroMinValue","showAvgLine"],function(t){Dt=t[0]||Dt,Nt=t[1]||Nt,Gt=t[2]||Gt,Pt=t[3]||Pt,Ot=t[4]||Ot,u.render(ht,vt)}),u.$watchGroup(["metricUrl","metricId","metricType","metricTenantId","timeRangeInSeconds"],function(t){yt=t[0]||yt,xt=t[1]||xt,kt=t[2]||xt,wt=t[3]||wt,At=t[4]||At,q()}),u.$watch("refreshIntervalInSeconds",function(t){t&&(bt=+t,o.cancel(ea),ea=o(function(){q()},1e3*bt))}),u.$on("$destroy",function(){o.cancel(ea)}),u.$on("DateRangeDragChanged",function(t,a){u.$emit("GraphTimeRangeChangedEvent",a)}),u.render=function(t,n){(t||X)&&(a&&console.group("Render Chart"),a&&console.time("chartRender"),na||p(),t&&v(t),X&&y(X),Dt&&Dt>mt&&dt>Dt&&O(_(Z,Dt)),z(),N(),W(Nt),zt&&Y(Z),G(n),P(),V(),Ot&&B(),Dt&&Dt>mt&&dt>Dt&&F(Dt),St&&J(St),a&&console.timeEnd("chartRender"),a&&console.groupEnd("Render Chart"))}}return{link:u,restrict:"E",replace:!0,scope:{data:"=",multiData:"=",metricUrl:"@",metricId:"@",metricType:"@",metricTenantId:"@",startTimestamp:"@",endTimestamp:"@",timeRangeInSeconds:"@",refreshIntervalInSeconds:"@",previousRangeData:"@",annotationData:"@",contextData:"@",showDataPoints:"=",alertValue:"@",interpolation:"@",multiChartOverlayData:"@",chartHeight:"@",chartType:"@",yAxisUnits:"@",
useZeroMinValue:"=",buttonbarDatetimeFormat:"@",timeLabel:"@",dateLabel:"@",chartHoverDateFormat:"@",chartHoverTimeFormat:"@",singleValueLabel:"@",noDataLabel:"@",aggregateLabel:"@",startLabel:"@",endLabel:"@",durationLabel:"@",minLabel:"@",maxLabel:"@",avgLabel:"@",timestampLabel:"@",showAvgLine:"=",hideHighLowValues:"=",chartTitle:"@"}}}])}(Charts||(Charts={}));